/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/core/ValueStateSupport","./TextFieldRenderer","sap/ui/core/library","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/core/Configuration","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/selectText"],function(e,t,i,r,a,s,o,n,u){"use strict";var p=s.AccessibleRole;var l=s.Design;var h=s.ImeMode;var d=s.TextAlign;var f=s.ValueState;var g=s.TextDirection;var c=i.extend("sap.ui.commons.TextField",{metadata:{interfaces:["sap.ui.commons.ToolbarItem","sap.ui.core.IFormContent"],library:"sap.ui.commons",deprecated:true,properties:{value:{type:"string",group:"Data",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:g.Inherit},enabled:{type:"boolean",group:"Behavior",defaultValue:true},editable:{type:"boolean",group:"Behavior",defaultValue:true},required:{type:"boolean",group:"Appearance",defaultValue:false},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},maxLength:{type:"int",group:"Behavior",defaultValue:0},valueState:{type:"sap.ui.core.ValueState",group:"Data",defaultValue:f.None},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:d.Begin},imeMode:{type:"sap.ui.core.ImeMode",group:"Behavior",defaultValue:h.Auto},design:{type:"sap.ui.core.Design",group:"Appearance",defaultValue:l.Standard},helpId:{type:"string",group:"Behavior",defaultValue:""},accessibleRole:{type:"sap.ui.core.AccessibleRole",group:"Accessibility",defaultValue:p.Textbox},name:{type:"string",group:"Misc",defaultValue:null},placeholder:{type:"string",group:"Appearance",defaultValue:null}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{change:{parameters:{newValue:{type:"string"}}},liveChange:{parameters:{liveValue:{type:"string"}}}}}});c.prototype.init=function(){};c.prototype.onfocusin=function(e){if(this.getEditable()&&this.getEnabled()&&this.getRenderer().onfocus){this.getRenderer().onfocus(this)}};c.prototype.onsapfocusleave=function(t){this._doOnEscape(t);this._checkChange(t);if(this.getEditable()&&this.getEnabled()&&this.getRenderer().onblur){this.getRenderer().onblur(this)}var i=e(this.getFocusDomRef());if(i.data("sap.InNavArea")===false){i.data("sap.InNavArea",true)}};c.prototype.onsapenter=function(e){this._checkChange(e)};c.prototype._checkChange=function(e){var t=this.getInputDomRef(),i=t&&t.value,r=this.getValue();if(this.getEditable()&&this.getEnabled()&&r!=i){this.setProperty("value",i,true);this.fireChange({newValue:i})}};c.prototype.onselectstart=function(e){if(!this.getEnabled()){e.preventDefault();e.stopPropagation()}};c.prototype._checkCursorPosForNav=function(t,i){var r=u.getRTL();var a=i?r:!r;var s=e(this.getInputDomRef());var o=s.cursorPos();var n=s.val().length;if(r){o=n-o}if(!a&&o!=n||a&&o!=0){t.stopPropagation()}};c.prototype.onsapnext=function(t){if(t.keyCode!=n.ARROW_DOWN){if(e(this.getFocusDomRef()).data("sap.InNavArea")&&t.keyCode!=n.END){t.preventDefault();return}this._checkCursorPosForNav(t,true)}};c.prototype.onsapprevious=function(t){if(t.keyCode!=n.ARROW_UP){if(e(this.getFocusDomRef()).data("sap.InNavArea")&&t.keyCode!=n.HOME){t.preventDefault();return}this._checkCursorPosForNav(t,false)}};c.prototype.onsapnextmodifiers=c.prototype.onsapnext;c.prototype.onsappreviousmodifiers=c.prototype.onsapprevious;c.prototype.onsapend=c.prototype.onsapnext;c.prototype.onsaphome=c.prototype.onsapprevious;c.prototype.onsapexpand=function(t){var i=e(this.getFocusDomRef()).data("sap.InNavArea");if(i||i===false){t.stopPropagation();return}};c.prototype.onsapcollapse=c.prototype.onsapexpand;c.prototype.onsapescape=function(e){var t=this.getProperty("value");this._bEsc=true;this._sValue=t;var i=this.getInputDomRef();if(i&&i.value!==t&&!this._propagateEsc){e.stopPropagation()}if(!o.browser.firefox){this._doOnEscape(e)}};c.prototype.onkeydown=function(e){if(e.which==n.Z&&e.ctrlKey&&!e.altKey){e.preventDefault()}};c.prototype.onkeypress=function(t){this._doOnEscape(t);var i=t.which;if(i>0&&i!==n.ESCAPE){var r=e(this.getFocusDomRef());if(r.data("sap.InNavArea")){r.data("sap.InNavArea",false)}}};c.prototype._doOnEscape=function(t){if(this._bEsc){var i=this.getInputDomRef();if(i){if(i.value!==this._sValue){e(i).val(this._sValue)}var r=e(this.getFocusDomRef());if(r.data("sap.InNavArea")===false){r.data("sap.InNavArea",true)}}this._fireLiveChange(t);this._bEsc=undefined;this._sValue=undefined}};c.prototype.onkeyup=function(t){if(t.keyCode==n.F2){var i=e(this.getFocusDomRef());if(i.data("sap.InNavArea")){i.data("sap.InNavArea",false)}else if(i.data("sap.InNavArea")===false){i.data("sap.InNavArea",true)}}};c.prototype.oninput=function(e){this._fireLiveChange(e)};c.prototype._fireLiveChange=function(t){if(this.getEnabled()&&this.getEditable()){var i=e(this.getInputDomRef()).val();this.fireLiveChange({liveValue:i})}};c.prototype.setValueState=function(e){var t=this.getValueState();this.setProperty("valueState",e,true);e=this.getValueState();if(t==e){return this}if(!this.getDomRef()){return this}if(this.getRenderer().setValueState){this.getRenderer().setValueState(this,t,e)}if(this.delayedCallId){clearTimeout(this.delayedCallId);this.delayedCallId=null}if(f.Success==e){this.delayedCallId=setTimeout(function(){this.removeValidVisualization()}.bind(this),3e3)}return this};c.prototype.removeValidVisualization=function(){if(this.getRenderer().removeValidVisualization){this.getRenderer().removeValidVisualization(this)}};c.prototype.setEditable=function(e){var t=this.getEditable();this.setProperty("editable",e,true);e=this.getEditable();if(t!=e){if(this.getDomRef()&&this.getRenderer().setEditable){this.getRenderer().setEditable(this,e)}}return this};c.prototype.setEnabled=function(e){var t=this.getEnabled();this.setProperty("enabled",e,true);e=this.getEnabled();if(t!=e){if(this.getDomRef()&&this.getRenderer().setEnabled){this.getRenderer().setEnabled(this,e)}}return this};c.prototype.setRequired=function(e){var t=this.getRequired();this.setProperty("required",e,true);e=this.getRequired();if(t!=e){if(this.getDomRef()){if(this.getRenderer().setRequired){this.getRenderer().setRequired(this,e)}}this.fireEvent("requiredChanged",{required:e})}return this};c.prototype.setDesign=function(e){var t=this.getDesign();this.setProperty("design",e,true);e=this.getDesign();if(t!=e){if(this.getDomRef()){if(this.getRenderer().setDesign){this.getRenderer().setDesign(this,e)}}}return this};c.prototype.setValue=function(e){var t=e;if(t&&t.length>this.getMaxLength()&&this.getMaxLength()>0){t=t.substring(0,this.getMaxLength())}this.setProperty("value",t,true);t=this.getValue();var i=this.getInputDomRef();if(i&&i.value!==t){if(!o.support.input.placeholder){if(t){this.$().removeClass("sapUiTfPlace");i.value=t}else if(document.activeElement!==i){this.$().addClass("sapUiTfPlace");var r=this.getPlaceholder();if(this.getRenderer().convertPlaceholder){r=this.getRenderer().convertPlaceholder(this)}i.value=r}else{i.value=""}}else{i.value=t}this._sRenderedValue=t}return this};c.prototype.setTooltip=function(t){this._refreshTooltipBaseDelegate(t);this.setAggregation("tooltip",t,true);var i=this.getInputDomRef();if(i){var a=r.enrichTooltip(this,this.getTooltip_AsString());e(i).attr("title",a||"");if(this._getRenderOuter()){e(this.getDomRef()).attr("title",a||"")}}return this};c.prototype.getInputDomRef=function(){if(!this._getRenderOuter()){return this.getDomRef()||null}else{return this.getDomRef("input")||null}};c.prototype.applyFocusInfo=function(e){this.focus();this._restoreUnsavedUserInput(e.userinput);return this};c.prototype.getFocusInfo=function(){return{id:this.getId(),userinput:this._getUnsavedUserInputInfo()}};c.prototype.getLiveValue=function(){var t=this.getInputDomRef();if(t){return e(t).val()}else{return this.getValue()}};c.prototype.ondrop=function(e){if(o.browser.firefox){this.focus()}};c.prototype._getRenderOuter=function(){if(this.bRenderOuter==undefined){var e=this.getRenderer();if(e.renderOuterAttributes||e.renderOuterContentBefore||e.renderOuterContent){this.bRenderOuter=true}else{this.bRenderOuter=false}}return this.bRenderOuter};c.prototype.getIdForLabel=function(){if(!this._getRenderOuter()){return this.getId()}else{return this.getId()+"-input"}};c.prototype.getFocusDomRef=function(){return this.getInputDomRef()};c.prototype._getUnsavedUserInputInfo=function(){var t=this.$();if(t.length&&t.hasClass("sapUiTfFoc")&&!t.hasClass("sapUiTfPlace")&&this.getEnabled()&&this.getEditable()){var i=e(this.getInputDomRef());var r=i.val();var a=this.getValue();var s=0;var o=0;if(typeof i.get(0).selectionStart==="number"){s=i.get(0).selectionStart;o=i.get(0).selectionEnd}return{userinput:r,value:a,cursorPos:i.cursorPos(),selStart:s,selEnd:o}}return null};c.prototype._restoreUnsavedUserInput=function(t){if(t&&this.getEnabled()&&this.getEditable()&&this.getValue()==t.value){var i=t.userinput;if(i&&i.length>this.getMaxLength()&&this.getMaxLength()>0){i=i.substring(0,this.getMaxLength())}var r=e(this.getInputDomRef());if(i!=t.value){r.val(i)}r.cursorPos(t.cursorPos);if(t.selStart!=t.selEnd){r.selectText(t.selStart,t.selEnd)}}};c.prototype.getAccessibilityInfo=function(){return{role:"textbox",type:sap.ui.getCore().getLibraryResourceBundle("sap.ui.commons").getText("ACC_CTR_TYPE_INPUT"),description:this.getValue()||"",focusable:this.getEnabled(),enabled:this.getEnabled(),editable:this.getEnabled()&&this.getEditable()}};return c});
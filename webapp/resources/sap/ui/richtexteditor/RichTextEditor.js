/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/library","sap/ui/core/Locale","sap/ui/core/ResizeHandler","./library","./ToolbarWrapper","sap/ui/dom/includeScript","sap/base/Log","sap/base/security/sanitizeHTML","sap/ui/events/KeyCodes","sap/ui/core/Core","./RichTextEditorRenderer"],function(t,e,i,r,o,n,s,a,u,l,p,h){"use strict";var d=i.TextDirection;var y={Initial:"Initial",Loading:"Loading",Initializing:"Initializing",Loaded:"Loaded",Ready:"Ready",Destroyed:"Destroyed"};
/**
	 * Constructor for a new RichTextEditor.
	 *
	 *
	 * @param {string} [sId] ID for the new control, generated automatically if no ID is given
	 * @param {object} [mSettings] Initial settings for the new control
	 *
	 * @class
	 *
	 * The RichTextEditor-Control is used to enter formatted text. It uses the third-party component called TinyMCE.
	 * In addition to the native toolbar, you can also use a toolbar built with SAPUI5 controls.
	 * <h3>Overview</h3>
	 *
	 * With version 1.48 onward, aside from the native toolbar of the TinyMCE, the <code>RichTextEditor</code> can also use a
	 * toolbar built with SAPUI5 controls. Which toolbar is used is taken into consideration only while the
	 * control is being initialized and it will not be possible to change it during runtime, because of
	 * lifecycle incompatibilities between the SAPUI5 and the third-party library.
	 * The custom toolbar acts like a wrapper to the native toolbar and takes care of
	 * synchronizing the state of its internal controls with the current state of the selection in the editor
	 * (bold, italics, font styles etc.).
	 *
	 * <h4>Restrictions</h4>
	 *
	 * <b>Note: The <code>RichTextEditor</code> uses a third-party component and therefore
	 * some additional restrictions apply for its proper usage and support.
	 * For more information see the Preamble section in {@link topic:d4f3f1598373452bb73f2120930c133c sap.ui.richtexteditor}.
	 * </b>
	 *
	 * <h3>Guidelines</h3>
	 * <ul>
	 * <li> The <code>RichTextEditor</code> should be used for desktop apps only. However, if it is essential for your use case, you can enable the mobile version of TinyMCE, whilst having in mind the restrictions. For more information see the {@link topic:d4f3f1598373452bb73f2120930c133c sap.ui.richtexteditor documentation}.</li>
	 * <li> In order to be usable, the control needs a minimum width 17.5 rem and height of 12.5 rem.</li>
	 * <li> Do not instantiate the <code>RichTextEditor</code> from a hidden container.</li>
	 * <li> Make sure you destroy the <code>RichTextEditor</code> instance instead of hiding it and create a new one when you show it again.</li>
	 * </ul>
	 *
	 * <h3>Usage</h3>
	 *
	 * <h4>When to use</h4>
	 * <ul>
	 * <li>You want to enable users to enter text and other elements (tables, images) with different styles and colors.</li>
	 * <li>You need to provide a tool for texts that require additional formatting.</li>
	 * </ul>
	 *
	 * <h4> When not to use</h4>
	 * <ul>
	 * <li>You want to let users add simple text that doesnâ€™t require formatting. Use {@link sap.m.TextArea text area} instead.</li>
	 * <li>Use callbacks to the native third-party API with care, as there may be compatibility issues with later versions.</li>
	 * </ul>
	 *
	 * <h3>Custom toolbar - adding and removing buttons</h3>
	 * With version 1.102 it is possible to redefine the button groups configuration in order to show only particular set of buttons in the custom toolbar of the <code>RichTextEditor</code>.
	 * This is possible in few ways:
	 * <ul>
	 * <li>By providing the buttons group configurations as a whole by setting the <code>buttonGroups</code> property of the control.</li>
	 * <li>By providing individual button group configuration via <code>addButtonGroup</code> method.</li>
	 * </ul>
	 *
	 * Consider the following when choosing your approach:
	 * <ul>
	 * <li>Setting <code>buttonGroups</code> will override all current custom toolbar button group configurations. This method allows for total redefining of the custom toolbar groups.</li>
	 * <li>Using <code>addButtonGroups</code> will try to add non-existing group into the configuration array, however, if such group configuration exists already, a warning will be logged and the new configuration will not be added. In order to replace the existing configuration you will need to remove it first via <code>removeButtonGroup</code>.</li>
	 * </ul>
	 *
	 * Below is a list of supported groups and buttons, which can be specified in the configuration objects (format is <<group name>>: <<supported buttons>>):
	 *	<ul>
	 *		<li>font-style: bold, italic, underline, strikethrough</li>
	 *		<li>font: fontfamily (fontselect in TinyMCE5), fontsize (fontsizeselect in TinyMCE5), forecolor, backcolor</li>
	 *		<li>clipboard: cut, copy, paste</li>
	 *		<li>structure: bullist, numlist, outdent, indent</li>
	 *		<li>undo: undo, redo</li>
	 *		<li>insert: image, emoticons</li>
	 *		<li>link: link, unlink</li>
	 *		<li>text-align: alignleft, aligncenter, alignright, alignjustify</li>
	 *	</ul>
	 * Additional supported groups, which can be added only after the editor is loaded (they can not be specified in the above mentioned configuration):
	 *	<ul>
	 *		<li>table: table</li>
	 *		<li>styleselect: styleselect</li>
	 *	<ul>
	 * <b>Note!</b> Adding configuration for "text-align" group with any buttons will still render a menu button with all available options inside. Removing/hiding the group can be achieved by invoking <code>removeButtonGroup</code> or <code>setShowGroupTextAlign(false)</code> depending on the desired result.
	 *
	 * <b>Note!</b> There is no synchronization between the <code>setShowGroup*</code> properties and the configuration object that the application can specifying via <code>buttonGroups</code> in the constructor or on a later stage. This means that in case new configuration is provided and for particular group the passed object contains property <code>visible: true</code>, this group property will be respected no matter if the <code>RichTextEditor</code>'s property for this particular group is set to <code>false</code>.
	 * Example:
	 * Providing the following object as group configuration:
	 * {
	 * 	name: "font"
	 * 	visible: true
	 * }
	 * Will make the "font" group visible, no matter that calling <code>RichTextEditor.getShowGroupFont()</code> returns <code>false</code>.
	 *
	 * @extends sap.ui.core.Control
	 *
	 * @author SAP SE
	 *
	 * @constructor
	 * @public
	 * @disclaimer Since version 1.6.0.
	 * The RichTextEditor of SAPUI5 contains a third party component TinyMCE provided by Moxiecode Systems AB. The SAP license agreement covers the development of applications with RichTextEditor of SAPUI5 (as of May 2014).
	 * @alias sap.ui.richtexteditor.RichTextEditor
	 * @see {@link fiori:https://experience.sap.com/fiori-design-web/rich-text-editor/ Rich Text Editor}
	 * @see {@link topic:d4f3f1598373452bb73f2120930c133c}
	 */var c=e.extend("sap.ui.richtexteditor.RichTextEditor",{metadata:{library:"sap.ui.richtexteditor",properties:{value:{type:"string",group:"Data",defaultValue:""},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:d.Inherit},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},editorType:{type:"string",group:"Misc",defaultValue:"TinyMCE"},editorLocation:{type:"string",group:"Misc",defaultValue:"js/tiny_mce4/tinymce.js",deprecated:true},editable:{type:"boolean",group:"Misc",defaultValue:true},showGroupFontStyle:{type:"boolean",group:"Misc",defaultValue:true},showGroupTextAlign:{type:"boolean",group:"Misc",defaultValue:true},showGroupStructure:{type:"boolean",group:"Misc",defaultValue:true},showGroupFont:{type:"boolean",group:"Misc",defaultValue:false},showGroupClipboard:{type:"boolean",group:"Misc",defaultValue:true},showGroupInsert:{type:"boolean",group:"Misc",defaultValue:false},showGroupLink:{type:"boolean",group:"Misc",defaultValue:false},showGroupUndo:{type:"boolean",group:"Misc",defaultValue:false},wrapping:{type:"boolean",group:"Appearance",defaultValue:true},required:{type:"boolean",group:"Misc",defaultValue:false},sanitizeValue:{type:"boolean",group:"Misc",defaultValue:true},plugins:{type:"object[]",group:"Behavior",defaultValue:[]},useLegacyTheme:{type:"boolean",group:"Appearance",defaultValue:true},buttonGroups:{type:"object[]",group:"Behavior",defaultValue:[]},customToolbar:{type:"boolean",group:"Misc",defaultValue:false}},events:{change:{parameters:{newValue:{type:"string"}}},ready:{},readyRecurring:{},beforeEditorInit:{}},aggregations:{_toolbarWrapper:{type:"sap.ui.richtexteditor.IToolbar",multiple:false,visibility:"hidden",defaultValue:null},customButtons:{type:"sap.ui.core.Control",multiple:true,singularName:"customButton",defaultValue:null}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}}}});c._lastId=0;c._iCountInstances=0;c.BUTTON_GROUPS=n.ButtonGroups;c.EDITORTYPE_TINYMCE4=n.EditorType.TinyMCE4;c.EDITORTYPE_TINYMCE5=n.EditorType.TinyMCE5;c.EDITORTYPE_TINYMCE6=n.EditorType.TinyMCE6;c.EDITORTYPE_TINYMCE=n.EditorType.TinyMCE;var E={};E[c.EDITORTYPE_TINYMCE]="js/tiny_mce6/tinymce.min.js";E[c.EDITORTYPE_TINYMCE4]="js/tiny_mce4/tinymce.min.js";E[c.EDITORTYPE_TINYMCE5]="js/tiny_mce5/tinymce.min.js";E[c.EDITORTYPE_TINYMCE6]="js/tiny_mce6/tinymce.min.js";c.DEFAULT_PLUGINS_TINYMCE5=["emoticons","directionality","tabfocus","table","image","link","textcolor","colorpicker","textpattern","powerpaste"];c.DEFAULT_PLUGINS_TINYMCE6=["emoticons","directionality","image","table","link","powerpaste"];c.MAPPED_LANGUAGES_TINYMCE={bg:"bg_BG",en_US:"en_GB",fr:"fr_FR",fr_CA:"fr_FR",hu:"hu_HU",in:"id",iw:"he",ji:"yi",ko:"ko_KR",no:"nb",pt:"pt_PT",sh:"sr",sl:"sl_SI",sv:"sv_SE",th:"th_TH"};c.SUPPORTED_LANGUAGES_TINYMCE={en:true,af_ZA:true,ar_SA:true,ar:true,az:true,be:true,bg_BG:true,bn_BD:true,bs:true,ca:true,cs_CZ:true,cs:true,cy:true,da:true,de_AT:true,de:true,dv:true,el:true,en_CA:true,en_GB:true,es_MX:true,es:true,et:true,eu:true,fa_IR:true,fa:true,fi:true,fo:true,fr_FR:true,ga:true,gd:true,gl:true,he_IL:true,hi:true,hi_IN:true,hr:true,hu_HU:true,hy:true,id:true,is_IS:true,it:true,ja:true,ka_GE:true,kab:true,kk:true,km_KH:true,ko_KR:true,ku_IQ:true,ku:true,lb:true,lt:true,lv:true,ml_IN:true,ml:true,mn_MN:true,nb_NO:true,nl:true,pl:true,pt_BR:true,pt_PT:true,ro:true,ru:true,si_LK:true,sk:true,sl_SI:true,sl:true,sr:true,sv_SE:true,ta_IN:true,ta:true,tg:true,th_TH:true,tr_TR:true,tr:true,tt:true,ug:true,uk_UA:true,uk:true,uz:true,vi_VN:true,vi:true,zh_CN:true,zh_TW:true};c.SUPPORTED_LANGUAGES_TINYMCE5={eo:true,es_ES:true,it_IT:true,ro_RO:true};c.SUPPORTED_LANGUAGES_TINYMCE6=c.SUPPORTED_LANGUAGES_TINYMCE5;c.SUPPORTED_LANGUAGES_DEFAULT_REGIONS={zh:"CN",fr:"FR",bn:"BD",bg:"BG",ka:"GE",he:"IL",hi:"IN",hu:"HU",is:"IS",km:"KH",ko:"KR",ku:"IQ",ml:"IN",mn:"MN",nb:"NO",pt:"PT",si:"SI",sl:"SI",sv:"SE",th:"TH",tr:"TR",vi:"VN"};c.SUPPORTED_LANGUAGES_DEFAULT_REGIONS_TINYMCE6={zh:"CN",fr:"FR",bn:"BD",bg:"BG",ka:"GE",he:"IL",hu:"HU",is:"IS",km:"KH",ko:"KR",ku:"IQ",ml:"IN",mn:"MN",nb:"NO",pt:"PT",si:"SI",sl:"SI",sv:"SE",th:"TH"};c.pLoadTinyMCE=null;var g={};g[c.EDITORTYPE_TINYMCE]=c.EDITORTYPE_TINYMCE6;g[c.EDITORTYPE_TINYMCE4]=c.EDITORTYPE_TINYMCE4;g[c.EDITORTYPE_TINYMCE5]=c.EDITORTYPE_TINYMCE5;g[c.EDITORTYPE_TINYMCE6]=c.EDITORTYPE_TINYMCE6;c.loadTinyMCE=function(t){if(t){var e=sap.ui.require.toUrl("sap/ui/richtexteditor/"+t),i=document.querySelector("#sapui5-tinyMCE"),r=i?i.getAttribute("src"):"";if(e!==r&&c._iCountInstances===1){delete window.tinymce;delete window.TinyMCE;c.pLoadTinyMCE=null}if(!c.pLoadTinyMCE){c.pLoadTinyMCE=a({id:"sapui5-tinyMCE",url:e})}}return c.pLoadTinyMCE};c.prototype.init=function(){var t=g[this.getEditorType()]||c.EDITORTYPE_TINYMCE;this._bEditorCreated=false;this._sTimerId=null;c._iCountInstances++;this._textAreaId=this.getId()+"-textarea";this._iframeId=this._textAreaId+"_ifr";this._textAreaDom=document.createElement("textarea");this._textAreaDom.id=this._textAreaId;this._textAreaDom.style.height="100%";this._textAreaDom.style.width="100%";this.setEditorType(t);this._setupToolbar()};c.prototype.onBeforeRendering=function(){this._customToolbarEnablement();var t=this.getAggregation("_toolbarWrapper");if(t){t.setToolbarEnabled(this.getEditable(),true)}if(!this._bCustomToolbarRequirementsFullfiled&&this.getCustomToolbar()){u.warning("Cannot set custom toolbar - not all requirements are fulfilled.")}if(this.isPropertyInitial("editorType")){u.info("You are using the default value of the editorType which is subject to changes and might affect your application.")}this.onBeforeRenderingTinyMCE()};c.prototype.onAfterRendering=function(){this.onAfterRenderingTinyMCE()};c.prototype.reinitialize=function(){clearTimeout(this._iReinitTimeout);this._iReinitTimeout=window.setTimeout(this.reinitializeTinyMCE.bind(this),0)};c.prototype.getNativeApi=function(){return this.getNativeApiTinyMCE()};c.prototype.exit=function(){clearTimeout(this._reinitDelay);this.exitTinyMCE();c._iCountInstances--};c.prototype.setValue=function(t){t=t===null||t===undefined?"":t;if(this.getSanitizeValue()){u.trace("sanitizing HTML content for "+this);t=l(t)}if(t===this.getValue()){return this}this.setProperty("value",t,true);t=this.getProperty("value");if(g[this.getEditorType()]){this.setValueTinyMCE(t)}else{this.reinitialize()}return this};c.prototype.setEditable=function(t){var e=this.getAggregation("_toolbarWrapper");this.setProperty("editable",t,true);if(e){e.setToolbarEnabled(t,true)}this.reinitialize();return this};c.prototype.setWrapping=function(t){this.setProperty("wrapping",t,true);this.reinitialize();return this};c.prototype.setRequired=function(t){this.setProperty("required",t,true);this.reinitialize();return this};c.prototype._setShowGroup=function(t,e){var i=this.getAggregation("_toolbarWrapper");this.setProperty(e.property,t,true);this.setButtonGroupVisibility(e.buttonGroup,t);if(!i){this.reinitialize();return this}i.setShowGroup(e.buttonGroup,t);return this};c.prototype.setShowGroupFontStyle=function(t){return this._setShowGroup(t,{property:"showGroupFontStyle",buttonGroup:"font-style"})};c.prototype.setShowGroupTextAlign=function(t){return this._setShowGroup(t,{property:"showGroupTextAlign",buttonGroup:"text-align"})};c.prototype.setShowGroupStructure=function(t){return this._setShowGroup(t,{property:"showGroupStructure",buttonGroup:"structure"})};c.prototype.setShowGroupFont=function(t){return this._setShowGroup(t,{property:"showGroupFont",buttonGroup:"font"})};c.prototype.setShowGroupClipboard=function(t){return this._setShowGroup(t,{property:"showGroupClipboard",buttonGroup:"clipboard"})};c.prototype.setShowGroupInsert=function(t){return this._setShowGroup(t,{property:"showGroupInsert",buttonGroup:"insert"})};c.prototype.setShowGroupLink=function(t){return this._setShowGroup(t,{property:"showGroupLink",buttonGroup:"link"})};c.prototype.setShowGroupUndo=function(t){return this._setShowGroup(t,{property:"showGroupUndo",buttonGroup:"undo"})};c.prototype.setCustomToolbar=function(t){if(!this._tinyMCEStatus||this._tinyMCEStatus===y.Initial){this.setProperty("customToolbar",t)}else{u.error("Cannot set customToolbar property to "+t+" after initialization.",this)}return this};c.prototype.addPlugin=function(t){if(typeof t==="string"){t={name:t}}var e=this.getProperty("plugins")||[],i=e.some(function(e){return e.name===t.name});!i&&e.push(t);this.setProperty("plugins",e);this.reinitialize();return this};c.prototype.removePlugin=function(t){var e=this.getProperty("plugins").slice(0);for(var i=0;i<e.length;++i){if(e[i].name===t){e.splice(i,1);--i}}this.setProperty("plugins",e);this.reinitialize();return this};c.prototype.addButtonGroup=function(t){var e=this.getProperty("buttonGroups").slice(),i=this.getAggregation("_toolbarWrapper");if(!t){return this}for(var r=0;r<e.length;++r){if(typeof t==="string"&&e[r].name===t||e[r].name===t.name){u.warning("Trying to add already existing group: "+(typeof t==="string"?t:t.name)+". Please remove the group first and then add it.",this);return this}}if(typeof t==="object"&&!(t.name&&Array.isArray(t.buttons))){u.error("The properties 'name' and 'buttons' are mandatory for the group configuration object. Please make sure they exist within the provided configuration.",this);return this}if(typeof t==="object"&&!(Array.isArray(t.buttons)&&t.buttons.length)){u.error("The 'buttons' array of the provided group configuration object cannot be empty.",this);return this}if(typeof t==="string"){switch(t){case"formatselect":t={name:"formatselect",buttons:["formatselect"]};break;case"styleselect":t={name:"styleselect",buttons:["styleselect"],customToolbarPriority:40};break;case"table":t={name:"table",buttons:["table"],customToolbarPriority:90};break;case"blocks":t={name:"blocks",buttons:["blocks"]};break;case"styles":t={name:"styles",buttons:["styles"],customToolbarPriority:40};break;default:t={name:this._createId("buttonGroup"),buttons:[t]}}}this._checkAndUpdateGroupInfo(t);var o=this.getButtonGroups();o.push(t);this.setProperty("buttonGroups",o);if(i){i.addButtonGroupToContent(t)}return this};c.prototype.removeButtonGroup=function(t){var e=this.getProperty("buttonGroups").slice(0),i=this.getAggregation("_toolbarWrapper");for(var r=0;r<e.length;++r){if(e[r].name===t){e.splice(r,1);--r;i&&i.removeButtonGroup(t)}}this.setProperty("buttonGroups",e);this.reinitialize();return this};c.prototype.setButtonGroups=function(t){var e;if(!Array.isArray(t)){u.error("Button groups cannot be set: "+t+" is not an array.");return this}t.forEach(this._checkAndUpdateGroupInfo);this.setProperty("buttonGroups",t);e=this.getAggregation("_toolbarWrapper");if(e){e.setButtonGroups(t)}this.reinitialize();return this};c.prototype._checkAndUpdateGroupInfo=function(t){if(t.visible===undefined){t.visible=true}if(t.priority===undefined){t.priority=10}if(t.row===undefined){t.row=0}};c.prototype.setPlugins=function(t){var e=[];if(!Array.isArray(t)){u.error("Plugins cannot be set: "+t+" is not an array.");return this}e=t.filter(function(t){return t.name==="lists"});if(this.getShowGroupStructure()&&!e.length){t.push({name:"lists"})}return this.setProperty("plugins",t)};c.prototype.setButtonGroupVisibility=function(t,e){var i=this.getButtonGroups();for(var r=0,o=i.length;r<o;++r){if(i[r].name===t){i[r].visible=e}}return this};c.prototype._createId=function(t){if(t===undefined){t="_rte"}return t+c._lastId++};c.prototype._setupToolbar=function(){var t=function(t){return t.map(function(t){return{name:t}})};var e={TinyMCE:t(c.DEFAULT_PLUGINS_TINYMCE6),TinyMCE4:t(c.DEFAULT_PLUGINS_TINYMCE5),TinyMCE5:t(c.DEFAULT_PLUGINS_TINYMCE5),TinyMCE6:t(c.DEFAULT_PLUGINS_TINYMCE6)};this.setPlugins(e[this.getEditorType()]);var i={TinyMCE:["fontfamily","fontsize","forecolor","backcolor"],TinyMCE4:["fontselect","fontsizeselect","forecolor","backcolor"],TinyMCE5:["fontselect","fontsizeselect","forecolor","backcolor"],TinyMCE6:["fontfamily","fontsize","forecolor","backcolor"]};this.setButtonGroups([{name:"font-style",visible:true,row:0,priority:10,customToolbarPriority:20,buttons:["bold","italic","underline","strikethrough"]},{name:"font",visible:false,row:0,priority:30,customToolbarPriority:50,buttons:i[this.getEditorType()]},{name:"clipboard",visible:true,row:1,priority:10,customToolbarPriority:110,buttons:["cut","copy","paste"]},{name:"structure",visible:true,row:1,priority:20,customToolbarPriority:60,buttons:["bullist","numlist","outdent","indent"]},{name:"undo",visible:false,row:1,priority:40,customToolbarPriority:100,buttons:["undo","redo"]},{name:"insert",visible:false,row:1,priority:50,customToolbarPriority:80,buttons:["image","emoticons"]},{name:"link",visible:false,row:1,priority:60,customToolbarPriority:70,buttons:["link","unlink"]},{name:"text-align",visible:true,row:0,priority:20,customToolbarPriority:30,buttons:["alignleft","aligncenter","alignright","alignjustify"]}])};c.prototype.setEditorType=function(t){if(!this._bEditorCreated){this.setProperty("editorType",t);t=this.getEditorType();this._setupToolbar();this.setEditorLocation(E[this.getEditorType()]);if(!g[t]){u.error("TinyMCE3 is removed now due to security concerns, please do NOT use it anymore. The framework automatically will load TinyMCE4 since v1.60")}if(g[t]==="TinyMCE4"){u.error("TinyMCE version 4 is used as editor. This version is no longer supported by TinyMCE and will be removed in future releases, therefore using it is at your own risk. Please consider upgrading to TinyMCE version 6.")}this.initTinyMCE()}else{u.error("editorType property cannot be set after the RichtextEditor has been rendered")}return this};c.prototype.setEditorLocation=function(t){if(!this._bEditorCreated){this.setProperty("editorLocation",t)}else{u.error("editorLocation property cannot be set after the RichtextEditor has been rendered")}return this};c.prototype._createButtonRowsTinyMCE=function(t,e){t=t===undefined?",":t;e=e===undefined?"|":e;var i=this.getButtonGroups(),r=t+e+t,o,n,s,a={},u=[c.EDITORTYPE_TINYMCE5,c.EDITORTYPE_TINYMCE6,c.EDITORTYPE_TINYMCE].includes(this.getEditorType()),l="",p=[];for(o=0,n=i.length;o<n;++o){s=i[o];if(!a[s.priority]){a[s.priority]=[]}if(s.priority===undefined){s.priority=Number.MAX_VALUE}a[s.priority].push(s)}for(var h in a){for(o=0,n=a[h].length;o<n;++o){s=a[h][o];var d=s.row||0;if(!s.visible||!s.buttons||s.buttons.length===0){continue}if(u){if(!l){l=""}l+=s.buttons.join(t)+r}else{if(!p[d]){p[d]=""}p[d]+=s.buttons.join(t)+r}}}if(u){return l}for(o=0;o<p.length;++o){if(p[o]===null){continue}else if(!p[o]){p.splice(o,1);p.push(null);continue}if(p[o].substr(-3)===r){p[o]=p[o].substr(0,p[o].length-r.length)}if(p[o].substr(-1)===t){p[o]=p[o].substr(0,p[o].length-t.length)}if(p[o].length===0){p.splice(o,1);p.push(null)}}return p};c.prototype._createPluginsListTinyMCE=function(){var t=this.getPlugins(),e=[];for(var i=0,r=t.length;i<r;++i){e.push(t[i].name)}return e.join(",")};c.prototype.onTinyMCEChange=function(t){var e=this.getValue(),i=t.getContent(),r=this.getSanitizeValue()?l(i):i;if(e!==r&&!this.bExiting){this.setProperty("value",r,true);this.fireChange({oldValue:e,newValue:r})}};c.prototype.initTinyMCE=function(){this._oEditor=null;this._tinyMCEStatus=y.Initial;this._boundResizeEditorTinyMCE=this._resizeEditorTinyMCE.bind(this);this._bInitializationPending=false;this._lastRestHeight=0};c.prototype.exitTinyMCE=function(){this._bUnloading=true;o.deregister(this._resizeHandlerId);this._resizeHandlerId=null;this._removeEditorTinyMCE()};c.prototype._removeEditorTinyMCE=function(){switch(this._tinyMCEStatus){case y.Initial:case y.Loading:case y.Loaded:break;case y.Initializing:this._pTinyMCEInitialized.then(this._removeEditorTinyMCE.bind(this,this._oEditor));break;case y.Ready:this._oEditor.remove();this._tinyMCEStatus=y.Destroyed;this._boundResizeEditorTinyMCE=null;this._oEditor=null;break;case y.Destroyed:break;default:u.error("Unknown TinyMCE status: "+this._tinyMCEStatus);break}};c.prototype._shouldLoadTinyMCE=function(){var t=this.getEditorType();if(!window.tinymce){return true}switch(t){case c.EDITORTYPE_TINYMCE4:return window.tinymce.majorVersion!="4";case c.EDITORTYPE_TINYMCE5:return window.tinymce.majorVersion!="5";case c.EDITORTYPE_TINYMCE6:return window.tinymce.majorVersion!="6";default:return false}};c.prototype.onBeforeRenderingTinyMCE=function(){if(this._shouldLoadTinyMCE()){this._tinyMCEStatus=y.Loading;this._pTinyMCELoaded=c.loadTinyMCE(this.getEditorLocation()).then(function(){this._tinyMCEStatus=y.Loaded}.bind(this))}else{this._pTinyMCELoaded=Promise.resolve();this._tinyMCEStatus=y.Loaded}};c.prototype.onAfterRenderingTinyMCE=function(){var t=this.getDomRef();if(this._shouldLoadTinyMCE()){this._pTinyMCELoaded.then(this.onAfterRenderingTinyMCE.bind(this))}else if(t){switch(this._tinyMCEStatus){case y.Initializing:t.appendChild(this._textAreaDom);break;case y.Loaded:case y.Loading:this.getDomRef().appendChild(this._textAreaDom);this.reinitializeTinyMCE();break;case y.Ready:t.appendChild(this._textAreaDom);this.reinitializeTinyMCE();break;default:u.error("Unknown TinyMCE status: "+this._tinyMCEStatus);break}}};c.prototype.reinitializeTinyMCE=function(){if(this._bInitializationPending||this._bUnloading){return}var t=function(){if(this._oEditor){this._oEditor.remove()}this._initializeTinyMCE()}.bind(this);switch(this._tinyMCEStatus){case y.Initial:break;case y.Loading:this._bInitializationPending=true;this._pTinyMCELoaded.then(t);break;case y.Initializing:this._bInitializationPending=true;this._pTinyMCEInitialized.then(t);break;case y.Loaded:case y.Ready:this._bInitializationPending=true;setTimeout(function(){t()},0);break;default:u.error("Unknown TinyMCE status: "+this._tinyMCEStatus);break}};c.prototype.getNativeApiTinyMCE=function(){return this._oEditor};c.prototype.setValueTinyMCE=function(e){switch(this._tinyMCEStatus){case y.Initial:case y.Initializing:case y.Loading:break;case y.Ready:this._oEditor.setContent(e);this._oEditor.undoManager.clear();this._oEditor.undoManager.add();if(!this.getEditable()){t.each(this._oEditor.getDoc().getElementsByTagName("a"),function(t,e){e.target="_blank"})}break;default:u.error("Unknown TinyMCE status: "+this._tinyMCEStatus);break}};c.prototype._initializeTinyMCE=function(){this._pTinyMCEInitialized=new Promise(function(t,e){this._bInitializationPending=false;this._tinyMCEStatus=y.Initializing;this._textAreaDom.value=this._patchTinyMCEValue(this.getValue());window.tinymce.init(this._createConfigTinyMCE(function(){this._tinyMCEStatus=y.Ready;setTimeout(function(){if(!this._bInitializationPending){this._onAfterReadyTinyMCE()}t()}.bind(this),0)}.bind(this)))}.bind(this))};c.prototype._patchTinyMCEValue=function(t){if(t.indexOf("\x3c!--")===0){t="&#8203;"+t}return t};c.prototype._onAfterReadyTinyMCE=function(){var e=document.getElementById(this._iframeId),i=this.getAggregation("_toolbarWrapper"),r=i&&i.getAggregation("_toolbar").getDomRef(),n=h.getLibraryResourceBundle("sap.ui.richtexteditor");if(e){e.setAttribute("aria-labelledby",this.getAriaLabelledBy().join(" "))}if(this._bUnloading){return}if(this._tinyMCEDesktopDetected()||!this._bHasNativeMobileSupport){i&&i.getAggregation("_toolbar").removeStyleClass("sapUiHidden")}this._oEditor.on("change",function(t){this.onTinyMCEChange(this._oEditor)}.bind(this));if(this.getCustomToolbar()){this._oEditor.save()}var s=t(e),a=t(this._oEditor.getBody()),u=false;a.on("focus",function(){if(!u){u=true;s.trigger("focus");a.trigger("focus");u=false}});if(this.getTooltip()&&this.getTooltip().length>0){var l=this.getTooltip_Text();this._oEditor.getBody().setAttribute("title",l);s.attr("title",l)}this._registerWithPopupTinyMCE();if(!this._resizeHandlerId){this._resizeHandlerId=o.register(this,this._boundResizeEditorTinyMCE)}this._resizeEditorOnDocumentReady();if(r){r.setAttribute("aria-roledescription",n.getText("CUSTOM_TOOLBAR_ARIA_ROLEDESCRIPTION"))}this._oEditor.getContainer().classList.add("sapUiRteEditorContainer");this.fireReadyTinyMCE()};c.prototype._resizeEditorOnDocumentReady=function(){var t=this._resizeEditorTinyMCE.bind(this);var e=this._oEditor.getDoc();if(!e){return}if(e.readyState=="complete"){t()}else{e.addEventListener("readystatechange",function(){if(e.readyState=="complete"){t()}})}};c.prototype._tinyMCEDesktopDetected=function(){return window.tinymce&&window.tinymce.Env.desktop};c.prototype.fireReadyTinyMCE=function(){switch(this._tinyMCEStatus){case y.Initial:case y.Loading:case y.Loaded:case y.Initializing:break;case y.Ready:if(!this._bInitializationPending){if(!this._readyFired){this._readyFired=true;this.fireReady.apply(this,arguments)}this.fireReadyRecurring.apply(this,arguments)}break;default:u.error("Unknown TinyMCE status: "+this._tinyMCEStatus);break}};c.prototype._getTextDirection=function(){if(this.getTextDirection()===this.getMetadata().getProperty("textDirection").getDefaultValue()){return h.getConfiguration().getRTL()?"rtl":"ltr"}else{return this.getTextDirection().toLowerCase()}};c.prototype._createConfigTinyMCE=function(t){var e=this.getAggregation("_toolbarWrapper");var i=this._createButtonRowsTinyMCE(" ","|");if(i.length===0){i=false}var r=this._createPluginsListTinyMCE();if(!this.getEditable()){r=r.replace(/(,powerpaste|powerpaste,)/gi,"")}var o=[c.EDITORTYPE_TINYMCE5,c.EDITORTYPE_TINYMCE6,c.EDITORTYPE_TINYMCE].includes(this.getEditorType());var n=this.getEditorType()===c.EDITORTYPE_TINYMCE6||this.getEditorType()===c.EDITORTYPE_TINYMCE;if(n){r=this.getPlugins().map(function(t){return t.name})}if(n&&!this.getEditable()){r=r.filter(function(t){return t!=="powerpaste"})}var s={height:"100%",directionality:this._getTextDirection(),selector:"[id='"+this._textAreaId+"']",theme:o?"silver":"modern",menubar:false,language:this._getLanguageTinyMCE(),browser_spellcheck:true,convert_urls:false,plugins:r,contextmenu:false,toolbar_items_size:"small",toolbar:i,toolbar_mode:"sliding",statusbar:false,image_advtab:true,readonly:!this.getEditable(),nowrap:!this.getWrapping(),init_instance_callback:function(e){this._oEditor=e;t()}.bind(this),setup:function(t){t.on("Init",function(){if(this.editorManager.majorVersion==="4"){t.schema.getSpecialElements()["iframe"]=new RegExp("</iframe[^>]*>","gi")}})}};if(this._bCustomToolbarRequirementsFullfiled&&e){s=e.modifyRTEToolbarConfig(s)}this.fireBeforeEditorInit({configuration:s});this._bHasNativeMobileSupport=s.mobile;return s};c.prototype._getLanguageTinyMCE=function(){var t=new r(h.getConfiguration().getLanguage()),e=t.getLanguage(),i=t.getRegion(),o=[c.EDITORTYPE_TINYMCE5,c.EDITORTYPE_TINYMCE6,c.EDITORTYPE_TINYMCE].includes(this.getEditorType()),n=this.getEditorType()===c.EDITORTYPE_TINYMCE6||this.getEditorType()===c.EDITORTYPE_TINYMCE,s;e=c.MAPPED_LANGUAGES_TINYMCE[e]||e;if(!i){i=n?c.SUPPORTED_LANGUAGES_DEFAULT_REGIONS_TINYMCE6[e]:c.SUPPORTED_LANGUAGES_DEFAULT_REGIONS[e]}s=i?e+"_"+i.toUpperCase():e;if(c.SUPPORTED_LANGUAGES_TINYMCE[s]){return s}if(o){if(c.SUPPORTED_LANGUAGES_TINYMCE5[s]){return s}if(c.SUPPORTED_LANGUAGES_TINYMCE5[e]){return e}}if(c.SUPPORTED_LANGUAGES_TINYMCE[e]){return e}return"en"};c.prototype._resizeEditorTinyMCE=function(){if(this._tinyMCEStatus!==y.Ready){return}var t=this._oEditor.getContentAreaContainer(),e=this.getDomRef().offsetHeight,i=this._oEditor.getContainer().offsetHeight,r=t.offsetHeight,o=this.getAggregation("_toolbarWrapper"),n,s,a;n=o?o.getAggregation("_toolbar").getDomRef().offsetHeight:"0";s=e-(i-r)-n;a=Math.abs(this._lastRestHeight-s);if(a==0||a>5){try{this._oEditor.theme.resizeTo(undefined,s-2)}catch(t){}}this._lastRestHeight=s};c.prototype._registerWithPopupTinyMCE=function(){var e=h.getEventBus(),i=[c.EDITORTYPE_TINYMCE5,c.EDITORTYPE_TINYMCE6,c.EDITORTYPE_TINYMCE].includes(this.getEditorType()),r=this.$().closest("[data-sap-ui-popup]");setTimeout(function(){if(r.length===1){var o=r.attr("data-sap-ui-popup"),n="tox-dialog-"+this.getId(),s={id:this._iframeId};e.publish("sap.ui","sap.ui.core.Popup.addFocusableContent-"+o,s);if(this._oEditor){this._oEditor.on("OpenWindow",function(r){if(i){t(".tox-dialog[role='dialog']").attr("id",n)}var s={id:i?n:r.win._id};e.publish("sap.ui","sap.ui.core.Popup.addFocusableContent-"+o,s)});this._oEditor.on("CloseWindow",function(r){var s={id:i?n:r.win._id};e.publish("sap.ui","sap.ui.core.Popup.removeFocusableContent-"+o,s);if(i){t(".tox-dialog[role='dialog']").attr("id")}})}}}.bind(this),0)};c.prototype._checkCustomToolbarRequirements=function(){var t=this.getCustomToolbar()&&g[this.getEditorType()]&&n.RichTextEditorHelper.bSapMLoaded;this.$().toggleClass("sapUiRTEWithCustomToolbar",t);return t};c.prototype._customToolbarEnablement=function(){var t,e=this.getAggregation("_toolbarWrapper");this._bCustomToolbarRequirementsFullfiled=this._checkCustomToolbarRequirements();if(this._bCustomToolbarRequirementsFullfiled&&!e){t=this.getAggregation("customButtons");this.removeAllAggregation("customButtons");e=new s({editor:this});this.setAggregation("_toolbarWrapper",e);setTimeout(function(){var t=e.getAggregation("_toolbar");t&&t.addStyleClass("sapUiHidden")},0);if(t&&t.length){setTimeout(function(){t.forEach(function(t){e.modifyToolbarContent("add",t)})},0)}}};["add","destroy","get","indexOf","insert","removeAll","remove"].forEach(function(t){var e=t+"CustomButton"+(["destroy","get","removeAll"].indexOf(t)>-1?"s":"");var i=/^(add|insert|destroy)/.test(t);c.prototype[e]=function(){var e=null,r=arguments[0],o=this.getAggregation("_toolbarWrapper");if(typeof r==="object"&&r.getMetadata().getName()!=="sap.m.Button"){u.error("Only sap.m.Button is allowed as aggregation.");return i?this:undefined}if(o&&o.modifyToolbarContent){e=o.modifyToolbarContent.bind(o,t).apply(o,arguments)}else{e=this[t+"Aggregation"].bind(this,"customButtons").apply(this,arguments)}return i?this:e}});return c});
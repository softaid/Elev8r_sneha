/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/mdc/library","sap/ui/mdc/ActionToolbar","sap/m/OverflowToolbarRenderer","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/Title","sap/ui/mdc/library","sap/ui/mdc/chart/ChartTypeButton","./ChartSelectionDetails","sap/m/ToolbarSeparator","sap/ui/core/aria/HasPopup","sap/m/OverflowToolbarLayoutData"],function(t,e,o,n,a,i,s,r,l,h,c,d,u){"use strict";var g=o.extend("sap.ui.mdc.chart.ChartToolbar",{metadata:{library:"sap.ui.mdc",interfaces:[],defaultAggregation:"",properties:{},aggregations:{},associations:{},events:{}},renderer:n});var p=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");g.prototype.init=function(){o.prototype.init.apply(this,arguments)};g.prototype.createToolbarContent=function(t){this._chartInternalButtonsToEnable=[];this._oTitle=new s(t.getId()+"-title",{text:t.getHeader(),level:t.getHeaderLevel()});this.addBegin(this._oTitle);if(t.getVariant()){this.addVariantManagement(t.getVariant())}if(t.getShowSelectionDetails()){this._oChartSelectionDetails=new h(t.getId()+"-selectionDetails",{});this._oChartSelectionDetails.attachBeforeOpen(function(e){this._updateSelectionDetailsActions(t)}.bind(this));this.addEnd(this._oChartSelectionDetails)}var e=t.getP13nMode()||[];if(e.indexOf("Item")>-1&&(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(r.ChartToolbarActionType.DrillDownUp)<0)){this._oDrillDownBtn=new a(t.getId()+"-drillDown",{icon:"sap-icon://drill-down",tooltip:p.getText("chart.CHART_DRILLDOWN_TITLE"),text:p.getText("chart.CHART_DRILLDOWN_TITLE"),enabled:false,ariaHasPopup:d.ListBox,layoutData:new u({closeOverflowOnInteraction:false}),press:function(e){t._showDrillDown(this._oDrillDownBtn)}.bind(this)});this.addEnd(this._oDrillDownBtn);this._chartInternalButtonsToEnable.push(this._oDrillDownBtn)}if(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(r.ChartToolbarActionType.Legend)<0){this._oLegendBtn=new i(t.getId()+"btnLegend",{type:"Transparent",text:p.getText("chart.LEGENDBTN_TEXT"),tooltip:p.getText("chart.LEGENDBTN_TOOLTIP"),icon:"sap-icon://legend",pressed:"{$mdcChart>/legendVisible}",enabled:false});this.addEnd(this._oLegendBtn);this._chartInternalButtonsToEnable.push(this._oLegendBtn)}if(!t.getIgnoreToolbarActions().length||t.getIgnoreToolbarActions().indexOf(r.ChartToolbarActionType.ZoomInOut)){this.oZoomInButton=new a(t.getId()+"btnZoomIn",{icon:"sap-icon://zoom-in",tooltip:p.getText("chart.TOOLBAR_ZOOM_IN"),text:p.getText("chart.TOOLBAR_ZOOM_IN"),enabled:false,press:function e(o){t.zoomIn();this.toggleZoomButtons(t)}.bind(this)});this.oZoomOutButton=new a(t.getId()+"btnZoomOut",{icon:"sap-icon://zoom-out",tooltip:p.getText("chart.TOOLBAR_ZOOM_OUT"),text:p.getText("chart.TOOLBAR_ZOOM_OUT"),enabled:false,press:function e(o){t.zoomOut();this.toggleZoomButtons(t)}.bind(this)});this.addEnd(this.oZoomInButton);this.addEnd(this.oZoomOutButton)}if(e.indexOf("Sort")>-1||e.indexOf("Item")>-1){this._oSettingsBtn=new a(t.getId()+"-chart_settings",{icon:"sap-icon://action-settings",tooltip:p.getText("chart.SETTINGS"),text:p.getText("chart.SETTINGS"),enabled:false,press:function(e){var o=t.getP13nMode();var n=o.indexOf("Type");if(n>-1){o.splice(n,1)}if(t.isPropertyHelperFinal()){t.getEngine().uimanager.show(t,o)}else{t.finalizePropertyHelper().then(function(){t.getEngine().uimanager.show(t,o)})}}});this.addEnd(this._oSettingsBtn);this._chartInternalButtonsToEnable.push(this._oSettingsBtn)}if(t._getTypeBtnActive()){this._oChartTypeBtn=new l(t,{ariaHasPopup:d.ListBox,layoutData:new u({closeOverflowOnInteraction:false})});this._oChartTypeBtn.setEnabled(false);this.addEnd(this._oChartTypeBtn);this._chartInternalButtonsToEnable.push(this._oChartTypeBtn)}};g.prototype.addVariantManagement=function(t){if(t){if(this._oVariantManagement){this.removeBetween(this._oVariantManagement)}this._oVariantManagement=t;this.addBetween(this._oVariantManagement)}};g.prototype.toggleZoomButtons=function(t){var e=this._getZoomEnablement(t);if(e.enabled){this.oZoomInButton.setEnabled(e.enabledZoomIn);this.oZoomOutButton.setEnabled(e.enabledZoomOut)}else{this.oZoomInButton.setEnabled(false);this.oZoomOutButton.setEnabled(false)}};g.prototype.updateToolbar=function(t){this.toggleZoomButtons(t);if(!this._toolbarInitialUpdated){this.setEnabled(true);this._chartInternalButtonsToEnable.forEach(function(t){t.setEnabled(true)});this._toolbarInitialUpdated=true}var e=t.getSelectionHandler();if(e&&t.getShowSelectionDetails()){this._oChartSelectionDetails.attachSelectionHandler(e.eventId,e.listener)}};g.prototype._getZoomEnablement=function(t){var e;try{e=t.getZoomState()}catch(t){e={enabled:false}}if(e&&e.hasOwnProperty("currentZoomLevel")&&e.currentZoomLevel!=null&&e.enabled){var o={enabled:true};o.enabledZoomOut=e.currentZoomLevel>0;o.enabledZoomIn=e.currentZoomLevel<1;return o}else{return{enabled:false}}};g.prototype._updateSelectionDetailsActions=function(t){if(!t.getShowSelectionDetails()){return}var e=t.getSelectionDetailsActions(),o;if(e){var n=this._oChartSelectionDetails.getItems();n.forEach(function(t){var n=e.getDetailsItemActions();n.forEach(function(e){o=e.clone();t.addAction(o)})});var a=e.getDetailsActions();this._oChartSelectionDetails.removeAllActions();a.forEach(function(t){o=t.clone();this._oChartSelectionDetails.addAction(o)}.bind(this));var i=e.getActionGroups();this._oChartSelectionDetails.removeAllActionGroups();i.forEach(function(t){o=t.clone();this._oChartSelectionDetails.addActionGroup(o)}.bind(this))}};g.prototype._setHeaderLevel=function(t){this._oTitle.setLevel(t)};return g});
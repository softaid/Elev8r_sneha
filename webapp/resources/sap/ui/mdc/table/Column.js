/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./GridTableType","./ResponsiveTableType","../library","sap/base/Log","sap/m/library","sap/m/Label","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/ui/core/Control","sap/ui/core/Core"],function(e,t,i,o,n,a,l,r,s,p){"use strict";var u=i.TableType;var h=s.extend("sap.ui.mdc.table.Column",{metadata:{library:"sap.ui.mdc",defaultAggregation:"template",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minWidth:{type:"float",group:"Behavior",defaultValue:8},header:{type:"string"},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},hAlign:{type:"sap.ui.core.HorizontalAlign",defaultValue:"Begin"},importance:{type:"sap.ui.core.Priority",group:"Behavior",defaultValue:"None"},initialIndex:{type:"int",defaultValue:-1},dataProperty:{type:"string"},required:{type:"boolean",defaultValue:false}},aggregations:{template:{type:"sap.ui.core.Control",multiple:false},creationTemplate:{type:"sap.ui.core.Control",multiple:false}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.openEnd();if(t._oColumnHeaderLabel){e.renderControl(t._oColumnHeaderLabel.getLabel())}e.close("div")}}});h.prototype.init=function(){this.mSkipPropagation={template:true,creationTemplate:true};this._oManagedObjectModel=new r(this);this._oSettingsModel=new l({width:this.getWidth(),calculatedWidth:null,p13nWidth:null,resizable:false})};h.prototype.getInnerColumn=function(){var e=this.getTable();if(e&&(!this._oInnerColumn||this._oInnerColumn.isDestroyed())){this._oInnerColumn=this._createInnerColumn()}return this._oInnerColumn};h.prototype._createInnerColumn=function(){var i=this.getTable();var o;var a={parts:[{path:"$this>/width"},{path:"$columnSettings>/calculatedWidth"},{path:"$columnSettings>/p13nWidth"}],formatter:function(e,t,i){return i||t||e}};this._readP13nValues();if(i._isOfType(u.ResponsiveTable)){o=t.createColumn(this.getId()+"-innerColumn",{width:a,autoPopinWidth:"{$this>/minWidth}",hAlign:"{$this>/hAlign}",header:this._getColumnHeaderLabel(),importance:"{$this>/importance}",popinDisplay:"Inline",tooltip:"{$this>/tooltip}"})}else{o=e.createColumn(this.getId()+"-innerColumn",{width:a,minWidth:{path:"$this>/minWidth",formatter:function(e){return Math.round(e*parseFloat(n.BaseFontSize))}},hAlign:"{$this>/hAlign}",label:this._getColumnHeaderLabel(),resizable:"{$columnSettings>/resizable}",autoResizable:"{$columnSettings>/resizable}",tooltip:"{$this>/tooltip}",template:this.getTemplateClone()});o.setCreationTemplate(this.getCreationTemplateClone())}o.setModel(this._oManagedObjectModel,"$this");o.setModel(this._oSettingsModel,"$columnSettings");return o};var d=s.extend("sap.ui.mdc.table.ColumnHeaderLabel",{metadata:{final:true,aggregations:{label:{type:"sap.m.Label",multiple:false}},associations:{column:{type:"sap.ui.mdc.table.Column"}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("width","100%");e.openEnd();e.renderControl(p.byId(t.getColumn()));e.close("div")}},getText:function(){return this.getLabel().getText()},clone:function(){return this.getLabel().clone()}});h.prototype._getColumnHeaderLabel=function(){var e=this.getTable();if(e&&(!this._oColumnHeaderLabel||this._oColumnHeaderLabel.isDestroyed())){this._oColumnHeaderLabel=new d({column:this,label:new a({width:"{= ${$this>/headerVisible} ? null : '0px' }",text:"{$this>/header}",textAlign:"{$this>/hAlign}",tooltip:e._isOfType(u.ResponsiveTable)?"{$this>/tooltip}":"",wrapping:{parts:[{path:"$this>/headerVisible"},{path:"$columnSettings>/resizable"}],formatter:function(t,i){return e._isOfType(u.ResponsiveTable)&&t&&!i}},wrappingType:e._isOfType(u.ResponsiveTable)?"Hyphenated":null,required:"{$this>/required}"})})}return this._oColumnHeaderLabel};h.prototype.getTemplateClone=function(){var e=this.getTable();var t=this.getTemplate();if(e&&t&&(!this._oTemplateClone||this._oTemplateClone.isDestroyed())){this._oTemplateClone=t.clone();if(!e._isOfType(u.ResponsiveTable)){if(this._oTemplateClone.setWrapping){this._oTemplateClone.setWrapping(false)}if(this._oTemplateClone.setRenderWhitespace){this._oTemplateClone.setRenderWhitespace(false)}}}return this._oTemplateClone};h.prototype.getCreationTemplateClone=function(){var e=this.getTable();var t=this.getCreationTemplate();if(e&&t&&(!this._oCreationTemplateClone||this._oCreationTemplateClone.isDestroyed())){this._oCreationTemplateClone=t.clone();if(!e._isOfType(u.ResponsiveTable)){if(this._oCreationTemplateClone.setWrapping){this._oCreationTemplateClone.setWrapping(false)}if(this._oCreationTemplateClone.setRenderWhitespace){this._oCreationTemplateClone.setRenderWhitespace(false)}}}return this._oCreationTemplateClone};h.prototype.setHeader=function(e){this.setProperty("header",e,true);var t=this.getDomRef();if(t){t.textContent=this.getHeader()}return this};h.prototype.setTooltip=function(e){if(e&&e.isA&&e.isA("sap.ui.core.TooltipBase")){o.error("The control sap.ui.mdc.table.Column allows only strings as tooltip, but given is "+e);return this}return s.prototype.setTooltip.apply(this,arguments)};h.prototype._onTableChange=function(e){if(e.getParameter("name")==="enableColumnResize"){this._readTableSettings()}};h.prototype._readTableSettings=function(){var e=this.getTable();this._oSettingsModel.setProperty("/resizable",e.getEnableColumnResize())};h.prototype.setParent=function(e){var t=this.getTable();s.prototype.setParent.apply(this,arguments);if(this._bIsBeingMoved){return}this._disconnectFromTable(t);this._connectToTable()};h.prototype._connectToTable=function(){var e=this.getTable();if(!e){return}this._calculateColumnWidth();this._readP13nValues();this._readTableSettings();e.attachEvent("_change",this._onTableChange,this)};h.prototype._disconnectFromTable=function(e){e=e||this.getTable();if(!e){return}if(this._oInnerColumn){this._oInnerColumn.destroy("KeepDom");if(!e.isInvalidateSuppressed()){e.invalidate()}}};h.prototype._onModifications=function(){this._readP13nValues()};h.prototype._calculateColumnWidth=function(){var e=this.getTable();if(!e||!e.getEnableAutoColumnWidth()||!this.isPropertyInitial("width")){return}var t=e.getPropertyHelper();if(t){this._oSettingsModel.setProperty("/calculatedWidth",t.calculateColumnWidth(this))}else{e.awaitPropertyHelper().then(this._calculateColumnWidth.bind(this))}};h.prototype._readP13nValues=function(){var e=this.getTable();var t=e.getCurrentState().xConfig;var i=this.getDataProperty();if(t instanceof Promise){t.then(this._readP13nValues.bind(this));return}var o=t&&t.aggregations&&t.aggregations.columns&&t.aggregations.columns[i]&&t.aggregations.columns[i].width;this._oSettingsModel.setProperty("/p13nWidth",o)};h.prototype.getTable=function(){var e=this.getParent();return e&&e.isA("sap.ui.mdc.Table")?e:null};h.prototype.exit=function(){this._disconnectFromTable();["_oManagedObjectModel","_oSettingsModel","_oInnerColumn","_oTemplateClone","_oCreationTemplateClone","_oColumnHeaderLabel"].forEach(function(e){if(this[e]){this[e].destroy();delete this[e]}},this)};return h});
/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableTypeBase","../library","sap/m/Button","sap/m/plugins/ColumnResizer","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/Core"],function(e,t,o,i,n,s,a,r){"use strict";var l,u,g;var p=t.GrowingMode;var h=t.RowAction;var d=e.extend("sap.ui.mdc.table.ResponsiveTableType",{metadata:{library:"sap.ui.mdc",properties:{growingMode:{type:"sap.ui.mdc.GrowingMode",defaultValue:p.Basic},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},popinLayout:{type:"sap.m.PopinLayout",group:"Appearance",defaultValue:"Block"}}}});d.prototype.setDetailsButtonSetting=function(e){return this.setProperty("detailsButtonSetting",e,true)};d.prototype.updateTableByProperty=function(e,t){var o=this.getInnerTable();if(!o){return}if(e==="growingMode"){o.setGrowingScrollToLoad(t===p.Scroll);o.setGrowing(t!==p.None)}else if(e==="showDetailsButton"){this._updateShowDetailsButton(o,t)}else if(e==="popinLayout"){o.setPopinLayout(t)}};d.prototype._updateShowDetailsButton=function(e,t){if(t&&!this._oShowDetailsButton){e.getHeaderToolbar().insertEnd(this._getShowDetailsButton(),0);e.attachEvent("popinChanged",this._onPopinChanged,this);e.setHiddenInPopin(this._getImportanceToHide())}else if(!t&&this._oShowDetailsButton){e.detachEvent("popinChanged",this._onPopinChanged,this);e.getHeaderToolbar().removeEnd(this._oShowDetailsButton);e.setHiddenInPopin([]);this._oShowDetailsButton.destroy();delete this._oShowDetailsButton}};d.prototype.loadModules=function(){if(!l){return new Promise(function(e,t){sap.ui.require(["sap/m/Table","sap/m/Column","sap/m/ColumnListItem"],function(t,o,i){l=t;u=o;g=i;e()},function(){t("Failed to load some modules")})})}else{return Promise.resolve()}};d.prototype.createTable=function(e){var t=this.getTable();if(!t||!l){return null}var o=new l(e,this.getTableSettings());o.bActiveHeaders=true;o.attachEvent("columnPress",this._onColumnPress,this);return o};d.prototype.getTableSettings=function(){var t=this.getTable();return Object.assign({},e.prototype.getTableSettings.apply(this,arguments),{autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","HeaderToolbar","InfoToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:this.getThreshold(),noData:t._getNoDataText(),headerToolbar:t._oToolbar,ariaLabelledBy:[t._oTitle],mode:this._getSelectionMode(),multiSelectMode:this._getMultiSelectMode()})};d.prototype._onItemPress=function(e){this.callHook("RowPress",this.getTable(),{bindingContext:e.getParameter("listItem").getBindingContext()});this._onRowActionPress(e)};d.prototype._onSelectionChange=function(e){var t=this.getTable();var o=e.getParameter("selectAll");if(o){var i=this.getRowBinding();if(!i){return}}this.callHook("SelectionChange",t,{bindingContext:e.getParameter("listItem").getBindingContext(),selected:e.getParameter("selected"),selectAll:o})};d.prototype._onColumnPress=function(e){var t=this.getTable();var o=this.getInnerTable();this.callHook("ColumnPress",t,{column:t.getColumns()[o.indexOfColumn(e.getParameter("column"))]})};d.createColumn=function(e,t){return new u(e,t)};d.prototype.createRowTemplate=function(e){return new g(e,this.getRowSettingsConfig())};d.prototype._getSelectionMode=function(){var e=this.getTable();var t=e?e.getSelectionMode():undefined;var o={Single:"SingleSelectLeft",SingleMaster:"SingleSelectMaster",Multi:"MultiSelect",None:"None",undefined:"None"};return o[t]};d.prototype._getMultiSelectMode=function(){var e=this.getTable();var t=e?e.getMultiSelectMode():undefined;var o={Default:"SelectAll",ClearAll:"ClearAll"};return o[t]};d.prototype.updateSelectionSettings=function(){var e=this.getTable();var t=this.getInnerTable();if(!e||!t){return}t.setMode(this._getSelectionMode());t.setMultiSelectMode(this._getMultiSelectMode())};d.prototype.updateRowSettings=function(){var e=this.getTable();if(!e||!e._oRowTemplate){return}e._oRowTemplate.unbindProperty("navigated");e._oRowTemplate.unbindProperty("highlight");e._oRowTemplate.unbindProperty("highlightText");e._oRowTemplate.applySettings(this.getRowSettingsConfig());this.updateRowActions()};d.prototype.updateRowActions=function(){var e=this.getTable();var t=this.getRowActionsConfig();var o=e.hasListeners("rowPress")?"Active":"Inactive";e._oRowTemplate.unbindProperty("type");if(!e.getRowSettings()){e._oRowTemplate.setType(o);return}var i,n,s;if("templateInfo"in t){var a=t.templateInfo;s=a.visible.formatter;n=typeof a.visible=="object";i=a.visible}else if(t&&t.items){var r;if(t.items.length==0){e._oRowTemplate.setType(o);return}r=t.items.find(function(e){return e.getType()=="Navigation"});if(!r&&t.items.length>0){throw new Error("No RowAction of type 'Navigation' found. sap.m.Table only accepts RowAction of type 'Navigation'.")}e._oRowTemplate.data("rowAction",r);n=r.isBound("visible");i=n?r.getBindingInfo("visible"):r.getVisible();s=i.formatter}if(s){i.formatter=function(e){var t=s(e);return t?h.Navigation:o}}else{i=i?h.Navigation:o}if(n){e._oRowTemplate.bindProperty("type",i)}else{e._oRowTemplate.setProperty("type",i)}};d.prototype.enableColumnResize=function(){var e=this.getTable();var t=this.getInnerTable();if(!e||!t){return}var o=i.getPlugin(t);t.setFixedLayout("Strict");if(!o){o=new i;t.addDependent(o);o.attachColumnResize(this._onColumnResize,this)}else{o.setEnabled(true);o.detachColumnResize(this._onColumnResize,this);o.attachColumnResize(this._onColumnResize,this)}};d.prototype.disableColumnResize=function(){var e=this.getTable();var t=this.getInnerTable();if(!e||!t){return}var o=i.getPlugin(t);if(o){o.setEnabled(false);o.detachColumnResize(this._onColumnResize,this)}};d.prototype._onColumnResize=function(e){var t=this.getTable();var o=this.getInnerTable();var i=e.getParameter("column");var n=e.getParameter("width");var s=o.indexOfColumn(i);var a=t.getColumns()[s];this.callHook("ColumnResize",t,{column:a,width:n})};d.prototype.createColumnResizeMenuItem=function(e,t){var o=i.getPlugin(this.getInnerTable());if(!o){return}if(t.isA("sap.m.table.columnmenu.Menu")){return o.getColumnResizeQuickAction(e.getInnerColumn(),t)}else{return o.getColumnResizeButton(e.getInnerColumn())}};d.prototype._toggleShowDetails=function(e){if(!this._oShowDetailsButton||e===this.bHideDetails){return}var t=this.getInnerTable();this.bHideDetails=e;if(this.bHideDetails){t.setHiddenInPopin(this._getImportanceToHide())}else{t.setHiddenInPopin([])}};d.prototype._getShowDetailsButton=function(){if(!this._oShowDetailsButton){var e=r.getLibraryResourceBundle("sap.ui.mdc");this.bHideDetails=true;this._oShowDetailsButton=new n(this.getTable().getId()+"-showHideDetails",{visible:false,selectedKey:"hideDetails",items:[new s({icon:"sap-icon://detail-more",key:"showDetails",tooltip:e.getText("table.SHOWDETAILS_TEXT"),press:[function(){this._toggleShowDetails(false)},this]}),new s({icon:"sap-icon://detail-less",key:"hideDetails",tooltip:e.getText("table.HIDEDETAILS_TEXT"),press:[function(){this._toggleShowDetails(true)},this]})]})}return this._oShowDetailsButton};d.prototype._getImportanceToHide=function(){var e=this.getDetailsButtonSetting()||[];if(e.length){return e}else{return a.system.phone?["Low","Medium"]:["Low"]}};d.prototype._onPopinChanged=function(e){var t=e.getParameter("hasPopin");var o=e.getParameter("hiddenInPopin");var i=e.getSource().getVisibleItems().length;if(i&&(o.length||t&&!this.bHideDetails)){this._oShowDetailsButton.setVisible(true)}else{this._oShowDetailsButton.setVisible(false)}};d.prototype._onRowActionPress=function(e){var t=this.getTable();var o=e.getParameter("listItem");if(o.getType()!=="Navigation"){return}var i=t.getRowSettings();var n=i.getAllActions();if(i.isBound("rowActions")){var s=n.items.model;if(!this._oRowActionItem){this._oRowActionItem=n.items.template.clone()}this._oRowActionItem.setModel(t.getModel(s),s);i.addDependent(this._oRowActionItem)}else{this._oRowActionItem=o.data("rowAction")}this._oRowActionItem.setType("Navigation");this.callHook("Press",this._oRowActionItem,{bindingContext:o.getBindingContext()})};d.prototype.removeToolbar=function(){var e=this.getInnerTable();if(e){e.setHeaderToolbar()}};d.prototype.scrollToIndex=function(e){var t=this.getInnerTable();if(t){return t.scrollToIndex(e)}else{return Promise.reject()}};d.prototype.getRowBinding=function(){var e=this.getInnerTable();return e?e.getBinding("items"):undefined};d.prototype.bindRows=function(e){var t=this.getInnerTable();if(t){t.bindItems(e)}};d.prototype.isTableBound=function(){var e=this.getInnerTable();if(e){return e.isBound("items")}else{return false}};d.prototype.insertFilterInfoBar=function(e,t){var o=this.getInnerTable();if(o){o.setInfoToolbar(e);if(!o.getAriaLabelledBy().includes(t)){o.addAriaLabelledBy(t)}}};d.prototype.updateSortIndicator=function(e,t){e.getInnerColumn().setSortIndicator(t)};return d});
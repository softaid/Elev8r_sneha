/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./SearchUrlParserInav2","./SearchHelper","./i18n","sap/m/MessageBox"],function(e,r,t,a){function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function i(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function o(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function s(e,r,t){if(r)o(e.prototype,r);if(t)o(e,t);Object.defineProperty(e,"prototype",{writable:false});return e}var l=n(e);var u=n(t);var c=a["Icon"];var f=a["Action"];function d(e,r,t){if(t){return r?r(e):e}if(!e||!e.then){e=Promise.resolve(e)}return r?e.then(r):e}function m(e,r,t){if(t){return r?r(e()):e()}try{var a=Promise.resolve(e());return r?a.then(r):a}catch(e){return Promise.reject(e)}}var h=function(){function e(r){i(this,e);this.model=r.model;this.urlParserInav2=new l(r)}s(e,[{key:"parse",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var a=this;return m(function(){if(!a.model.config.isSearchUrl(r.getHashFromUrl())){return Promise.resolve(undefined)}return r.hasher.hasChanged()?d(a.model.initAsync(),function(){var e=r.getUrlParameters();if($.isEmptyObject(e)){return undefined}if(e.datasource||e.searchterm){if(!e.datasource||a.isJson(e.datasource)){return a.urlParserInav2.parseUrlParameters(e)}}e=a.model.config.parseSearchUrlParameters(e);if(e.datasource&&!a.isJson(e.datasource)&&e.searchterm){a.parseSimplifiedUrlParameters(e)}else{a.parseUrlParameters(e)}a.model.setProperty("/searchTermPlaceholder",a.model.calculatePlaceholder());a.model.calculateSearchButtonStatus();if(t){a.model._firePerspectiveQuery({deserialization:true})}}):Promise.resolve(undefined)})}},{key:"isJson",value:function e(r){return r.indexOf("{")>=0&&r.indexOf("}")>=0}},{key:"parseSimplifiedUrlParameters",value:function e(r){if(r.top){var t=parseInt(r.top,10);this.model.setTop(t,false)}var a=this.model.sinaNext.createFilter();a.setSearchTerm(r.searchterm);var n=this.model.sinaNext.getDataSource(r.datasource);if(!n){n=this.model.sinaNext.allDataSource}a.setDataSource(n);this.model.setProperty("/uiFilter",a);this.model.setDataSource(a.dataSource,false,false)}},{key:"parseUrlParameters",value:function e(r){if(r.top){var t=parseInt(r.top,10);this.model.setTop(t,false)}var n;if(r.filter){try{var i=JSON.parse(r.filter);n=this.model.sinaNext.parseFilterFromJson(i);this.model.setProperty("/uiFilter",n);this.model.setDataSource(n.dataSource,false,false)}catch(e){a.show(u.getText("searchUrlParsingErrorLong")+"\n("+e.toString()+")",{icon:c.ERROR,title:u.getText("searchUrlParsingError"),actions:[f.OK]})}}}},{key:"render",value:function e(){return this.renderFromParameters(this.model.getTop(),this.model.getProperty("/uiFilter"),true)}},{key:"renderFromParameters",value:function e(r,t,a){var n={top:r,filter:a?encodeURIComponent(JSON.stringify(t.toJson())):JSON.stringify(t.toJson())};return this.model.config.renderSearchUrl(n)}}]);return e}();return h})})();
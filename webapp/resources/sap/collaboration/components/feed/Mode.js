/*
* ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/collaboration/components/utils/CommonUtil","sap/ui/model/odata/v2/ODataModel","sap/ui/thirdparty/jquery"],function(e,t,o,r,a,i,n){"use strict";var l=e.extend("sap.collaboration.components.feed.Mode",{constructor:function(e){this._oCommonUtil=new a;this._oFeedController=e;this._initializeModels();this._oViewDataModel=this._oFeedController.getModel();this._oJamModel=this._oFeedController.getModel("jam");var t=this._getGroupSelectorFragmentId();sap.ui.xmlfragment(t,"sap.collaboration.components.feed.fragments.GroupSelector",this);this._oGroupSelectPopover=r.byId(t,"responsivePopover");this._oGroupSelectPopover.setModel(this._oFeedController.getModel("i18n"),"i18n");this._oList=r.byId(t,"list");this._oList.addStyleClass("RightToLeftParenthesisStyling");this._oList.setBusyIndicatorDelay(0);this._oListItemTemplate=sap.ui.xmlfragment("sap.collaboration.components.feed.fragments.CustomListItem",this)}});l._bJamServiceAvailable=true;l._sJamServiceUrl="/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData";l._nextGroupSelectorFragmentIdIndex=0;l.prototype._getGroupSelectorFragmentId=function(){return this._oFeedController.createId("groupSelectorFragment")+l._nextGroupSelectorFragmentIdIndex++};l.prototype.getFeedEntries=function(e,t){var o=n.Deferred();var r={urlParameters:{$expand:"Creator,TargetObjectReference"},success:function(e,t){o.resolve(e,t)},error:function(e){o.reject(e)}};if(t){r.urlParameters.$skiptoken=t}return o.promise(this._oJamModel.read(e,r))};l.prototype.onGroupSearch=function(e){var r=new t("Name",o.Contains,e.getParameter("newValue"));this._oList.getBinding("items").filter([r])};l.prototype.addPost=function(e){var t=n.Deferred();var o=this.getAddPostPath();var r={Text:e};var a={success:function(e,o){t.resolve(e,o)},error:function(e){t.reject(e)}};return{path:o,payload:r,promise:t.promise(this._oJamModel.create(o,r,a))}};l.prototype.getFeedUpdatesLatestCount=function(){var e=n.Deferred();var t=this._oFeedController.byId("timeline").getContent()[0];var o=t?t.getModel().getProperty("/TopLevelId"):"";var r=this._oViewDataModel.getProperty("/groupSelected/Id");var a="/Group_FeedLatestCount";var i={urlParameters:{LatestTopLevelId:o,Id:r},success:function(t,o){e.resolve(t,o)},error:function(t){e.reject(t)}};return e.promise(this._oJamModel.callFunction(a,i))};l.prototype._initializeModels=function(){var e=new i(l._sJamServiceUrl);e.attachMetadataFailed(this._oFeedController._onMetadataFailed,this._oFeedController);e.attachRequestCompleted(this._oFeedController._onJamRequestCompleted,this._oFeedController);e.attachRequestFailed(this._oFeedController._onJamRequestFailed,this._oFeedController);e.attachRequestSent(this._oFeedController._onJamRequestSent,this._oFeedController);e.attachBatchRequestCompleted(this._oFeedController._onBatchCompleted,this._oFeedController);e.attachBatchRequestFailed(this._oFeedController._onBatchFailed,this._oFeedController);e.attachBatchRequestSent(this._oFeedController._onBatchSent,this._oFeedController);this._oFeedController.setJamModel(e)};l.prototype.getJamServiceUrl=function(){return l._sJamServiceUrl};l.prototype.isJamServiceAvailable=function(){return l._bJamServiceAvailable};l.prototype.setJamServiceAvailable=function(e){l._bJamServiceAvailable=e};return l});
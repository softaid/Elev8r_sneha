// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/extend","sap/ui/core/Configuration","sap/ui/core/Core","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/Config"],function(t,e,i,r,s,n){"use strict";var o=function(t){this.init(t)};o.prototype={settings:null,tileWidth:0,tileHeight:0,tileMargin:0,curTouchMatrixCords:null,tilesInRow:null,groupsList:null,item:null,matrix:null,tiles:null,collisionLeft:false,startGroup:null,currentGroup:null,endGroup:null,init:function(i){this.curTouchMatrixCords={column:null,row:null};this.endGroup=null;this.groupSwitched=false;this.item=null;this.matrix=null;this.tiles=null;this.collisionLeft=false;this.startArea=null;this.currentArea=null;this.endArea=undefined;this.startGroup=null;this.draggedTileDomRef=null;this.sDragStartGroupModelId=undefined;this.sDragTargetGroupModelId=undefined;this.currentGroup=null;this.groupsList=null;this.allGroups=null;this.settings=this.settings||i;t(this,this.settings);this.tileWidth=this.thisLayout.styleInfo.tileWidth;this.tileHeight=this.thisLayout.styleInfo.tileHeight;this.tileMargin=this.thisLayout.styleInfo.tileMarginWidth;this.aExcludedControlClass=this.aExcludedControlClass||[];this.reorderElementsCallback=this.reorderElementsCallback||function(){};this.rightToLeft=e.getRTL();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false;this.collidedLinkAreas=[];this.intersectedLink=null;this.aLinksBoundingRects=[];this.intersectedLinkPlaceHolder=undefined;this.isLinkPersonalizationSupported=this.thisLayout.oLaunchPageService?this.thisLayout.oLaunchPageService.isLinkPersonalizationSupported():null;this.isLinkMarkerShown=false;this.bIsTabBarCollision=false},moveDraggable:function(t,e,i){var r=this.getCollisionObject(t,e,i);var s;if(r){this._toggleAnchorItemHighlighting(false);if(r.collidedObjectType!=="TabBar"){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();this.bIsTabBarCollision=false}else{this.bIsTabBarCollision=true;this._toggleTabBarOverflowArrows(true);this.removePlaceHolders();this._handleTabBarCollision(t,i)}if(this.isLinkPersonalizationSupported&&r.collidedObjectType==="Group-link"){s=this._handleLinkAreaIntersection(r.collidedObject,t,e)}else if(r.collidedObjectType==="Group-tile"){s=this._handleTileAreaIntersection(r.collidedObject,t,e);this._toggleTileCloneHoverOpacity(false)}if(s||this.endAreaChanged){this.handlePlaceHolder(r.collidedObject)}}else{this._removeEmptyLinkAreaMark()}},_toggleAnchorItemHighlighting:function(t){if(this.targetGroup){this.targetGroup.classList.toggle("sapUshellAnchorItemDropCollision",t);this.targetGroup.firstElementChild.classList.toggle("sapUshellAnchorInnerMarker",t)}},removePlaceHolders:function(){this._removeLinkDropMarker();this._removeEmptyLinkAreaMark();this._handleChangedGroup(this.currentGroup)},handlePlaceHolder:function(t){if(this.endArea==="tiles"){if(this.endAreaChanged){this._removeLinkDropMarker()}this.handlePlaceholderChange()}else if(this.endArea==="links"&&this.intersectedLink){this._changeLinkPlaceholder(this.intersectedLink,t);if(this.endAreaChanged){this.handlePlaceholderChange()}}},switchLinkWithClone:function(t){if(t){this.intersectedLinkPlaceHolder=t.getDomRef().cloneNode(true);this.intersectedLinkPlaceHolder.setAttribute("id","sapUshellIntersectedLinkPlaceHolder");t.$().replaceWith(this.intersectedLinkPlaceHolder)}},_removeLinkDropMarker:function(){s("#sapUshellLinkDropMarker").remove();this.isLinkMarkerShown=false},saveLinkBoundingRects:function(t){var e=i.byId(t.getAttribute("id"));this.draggedLinkBoundingRects=e.getBoundingRects()},_getMarkerOffset:function(t,e){var i=e.getDomRef().getElementsByClassName("sapUshellLineModeContainer")[0].getBoundingClientRect();var r=i.left;var s=i.top;var n=this.rightToLeft?20:-1;var o=this.rightToLeft?42:21;var a=t[t.length-1].offset.x-r+t[t.length-1].width-n;var l=t[this.rightToLeft?t.length-1:0].offset.x-r-o;var h=t[this.rightToLeft?t.length-1:0].offset.y-s;var u=t[this.rightToLeft?0:t.length-1].offset.y-s;if(document.body.classList.contains("sapUiSizeCompact")){h-=6;u-=6}if(this.rightToLeft){if(i.right-t[t.length-1].offset.x-t[t.length-1].width<16){a=a-8}}else if(l<16){l=0}return{right:a,left:l,topLeft:h,topRight:u}},_changeLinkPlaceholder:function(t,e){var i=this.aLinksBoundingRects[t.link.getId()];var r=i.left;var n=i.topLeft;var o=i.topRight;var a=i.right;if(!e.getDomRef().querySelector("#sapUshellLinkDropMarker")){this._removeLinkDropMarker();var l=e.getDomRef().getElementsByClassName("sapUshellLinksInnerContainer")[0];s(l).prepend(this.LinkDropMarker)}this.LinkDropMarker.style.left=(t.leftSide?r:a)+"px";this.LinkDropMarker.style.top=(t.leftSide?n:o)+"px";this.isLinkMarkerShown=true},showTilePlaceholder:function(t,e,i){var r;var s=this.curTouchMatrixCords.row;var n=this.curTouchMatrixCords.column;this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;this.domRef.style.display="";this.removeExcludedElementsFromMatrix(this.aExcludedControlClass);r=this.tiles||this.thisLayout.getGroupTiles(this.endGroup).slice(0);if(this.matrix[s]&&typeof this.matrix[s][n]==="object"){this.handleMatrixCollision(r,t,e,i);return}this._handleMoveOutOfBorders(r,t)},removeTilePlaceholder:function(){this.domRef=this.item.getDomRef()||this.domRef;var t=this.thisLayout.getGroupTiles(this.currentGroup);t=t.slice(0);if(this.startArea!=="links"&&t.indexOf(this.item)>-1){t.splice(t.indexOf(this.item),1)}if(!this.domRef.parentNode.contains("sapUshellLinksInnerContainer")){this.domRef.style.display="none"}this.thisLayout.initGroupDragMode(this.endGroup);var e=this.thisLayout.organizeGroup(t);this.thisLayout.renderLayoutGroup(this.currentGroup,e)},handlePlaceholderChange:function(){var t=this.currentGroup;var e=this.endGroup!==this.currentGroup;var i=this.endAreaChanged&&this.endArea==="links";var r=this.thisLayout.isTabBarActive()&&this.groupSwitched;this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);this.matrix=this.thisLayout.organizeGroup(this.tiles);if(r){this.handleTabBarSwitch(t)}if(e){this._handleChangedGroup(t)}else if(i){this.removeTilePlaceholder()}if(!i){this.showTilePlaceholder(t,e,i)}},handleMatrixCollision:function(t,e,i,r){var s=this.matrix[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column];var n=t.indexOf(s);var o=t.indexOf(this.item);if(this.rightToLeft){this.collisionLeft=!this.collisionLeft}if(o>-1&&o<n){s=t[n+1]}if(s===this.item){if(i||r){t.splice(t.indexOf(this.item),1)}this._handleTileReplace(t,e);return}var a=this.changeTilesOrder(this.item,s,t,this.matrix);if(a&&!this.isLinkMarkerShown){this._handleTileReplace(a,e)}},handleTabBarSwitch:function(t){this._appendTargetGroupDomRefWithDraggedTile();if(!this.item.getDomRef()){this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.draggedTileDomRef)}else{this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.item.getDomRef())}this.currentGroup=this.endGroup;var e=this.thisLayout.getGroupTiles(t);this.thisLayout.initGroupDragMode(this.endGroup);var i=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,i)},_handleMoveOutOfBorders:function(t,e){var i=this.findTileToPlaceAfter(this.matrix,t);if(t[i+1]==this.item){return}var r;if(t[i+1]){r=t[i+1]}else if(this.currentGroup.getShowPlaceholder()){r=t[0]}var s=this.changeTilesOrder(this.item,r,t,this.matrix);if(s){this._handleTileReplace(s,e)}},_handleChangedGroup:function(t){var e=this.thisLayout.getGroupTiles(this.currentGroup);if(this.currentGroup===this.startGroup&&(this.startArea==="tiles"||this.intersectedLinkPlaceHolder)){e=e.slice(0);if(e.indexOf(this.item)>-1){e.splice(e.indexOf(this.item),1)}}if(this.startGroup===this.endGroup&&this.startArea==="tiles"){this.tiles.splice(this.tiles.indexOf(this.item),1)}var i=this.item.getDomRef()||this.domRef;if(this.startArea==="links"&&!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea==="tiles"){this.endGroup.getInnerContainersDomRefs()[0].appendChild(i)}if(!i.parentNode.contains("sapUshellLinksInnerContainer")){i.style.display="none"}this.currentGroup=this.endGroup;this.thisLayout.initGroupDragMode(this.endGroup);var r=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,r)},_handleTileReplace:function(t,e){this.reorderElementsCallback({currentGroup:e,endGroup:this.endGroup,tiles:t,item:this.item});this.reorderTilesView(t,this.endGroup);this.reorderTilesInDom();this.thisLayout.renderLayoutGroup(this.endGroup,this.matrix)},_getIntersectedLink:function(t,e,i){var r=document.getElementsByClassName("sapUshellLinkTile")[0];if(!r){return}var s=t.getDomRef().querySelector(".sapUshellLineModeContainer").getBoundingClientRect();var n=!document.body.classList.contains("sapUiSizeCompact");var o=Math.floor((i-s.top)/(n?45:31));var a=this.collidedLinkAreas[t.getId()];var l;if(this.rightToLeft){l=Math.floor((s.right-e)/20)}else{l=Math.floor((e-s.left)/20)}if(o<a.length&&a[o]&&l<a[o].length){return a[o][l]}else if(a.length){var h=a.length;if(o>=h){o=h-1}if(!this.collidedLinkAreas[t.getId()][o]){return}l=this.collidedLinkAreas[t.getId()][o].length;return this.collidedLinkAreas[t.getId()][o][l-1]}},_mapGroupLinks:function(t){var e=t.getId();if(!this.collidedLinkAreas[e]||this.bElapseGroupLinksMap){this.bElapseGroupLinksMap=false;var i=t.getLinks();var r=[];var s;var n;var o=0;this.collidedLinkAreas.push(t.getId());i.forEach(function(e){n=this._getLinkBoundingRects(e,t);n.forEach(function(i){if(i.offset.y>s){o++}s=i.offset.y;this._addLinkToHashMap(r,t,i,o,e)}.bind(this))}.bind(this));this.collidedLinkAreas[e]=r}},_getLinkBoundingRects:function(t,e){var i=t.getBoundingRects();if(this.item&&this.item.getId()===t.getId()){i=this.draggedLinkBoundingRects}if(i.length){this.aLinksBoundingRects[t.getId()]=this._getMarkerOffset(i,e)}return i},_addLinkToHashMap:function(t,e,i,r,s){if(!t[r]){t[r]=[]}for(var n=0;n<=(i.width+20)/20;n++){var o={link:s,leftSide:!this.rightToLeft};if(n>(i.width+20)/20/2){o.leftSide=this.rightToLeft}t[r].push(o)}},_isLinkAreaIntersection:function(t,e,i){var r=t.getInnerContainersDomRefs();if(r[1]){return this._isElementCollideByGivenCordinates(r[1],e,i)}return false},_isLinksEquals:function(t,e){if(!t||!e){return false}if(t.link.getId()!==e.link.getId()){return false}return t.link.leftSide===e.link.leftSide},_toggleTileCloneHoverOpacity:function(t){var e=document.getElementsByClassName("sapUshellTile-clone");for(var i=0;i<e.length;++i){e[i].classList.toggle("sapUshellTileDragOpacity",t)}},_handleLinkAreaIntersection:function(t,e,i){if(this.isLinkPersonalizationSupported){this._toggleTileCloneHoverOpacity(true)}this._mapGroupLinks(t);this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(t));var r=this._getIntersectedLink(t,e,i);var s=false;if(r){s=this._isLinksEquals(this.intersectedLink,r);this.intersectedLink=r}else{this.removeTilePlaceholder()}this._markEmptyLinkArea(t);return s},_markEmptyLinkArea:function(t){if(!t.getLinks().length){var e=t.getDomRef();if(e){var i=e.getElementsByClassName("sapUshellLineModeContainer");for(var r=0;r<i.length;++r){i[r].classList.add("sapUshellEmptyLinkAreaHover")}}}},_removeEmptyLinkAreaMark:function(){var t=document.getElementsByClassName("sapUshellLineModeContainer");for(var e=0;e<t.length;++e){t[e].classList.remove("sapUshellEmptyLinkAreaHover")}},reorderTilesInDom:function(){var t=this.item.getDomRef()?this.item.getDomRef():this.domRef;var e=s(t).index();var i=s(t).closest(".sapUshellTilesContainer-sortable");var r=this.calcDestIndexInGroup();var n=s(this.endGroup.getDomRef()).find(".sapUshellTilesContainer-sortable");var o=n.find(".sapUshellTile");if(this.startArea==="tiles"){i.find(o[e]).remove()}else if(!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea!=="links"){o=n.find(".sapUshellTile");n[0].insertBefore(t,o[r])}},isLinkIntersected:function(){return this.intersectedLink!==undefined},calcDestIndexInGroup:function(){var t;var e=0;var i;var r;var s=false;for(i=0;i<this.matrix.length&&!s;i++){for(r=0;r<this.matrix[i].length;r++){if(this.matrix[i][r]!==undefined){if(this.item.sId!==this.matrix[i][r].sId){if(t!==this.matrix[i][r].sId){t=this.matrix[i][r].sId;e++}}else{s=true;break}}}}return e},layoutStartCallback:function(t){this.init();this.item=i.byId(t.getAttribute("id"));this.tilesInRow=this.thisLayout.getTilesInRow();this.groupsList=this.thisLayout.getGroups();this.allGroups=this.thisLayout.getAllGroups();this.startGroup=this.currentGroup=this.item.getParent();this.groupSwitched=false;this.startArea=this.isLinkPersonalizationSupported&&this.item.getMode&&this.item.getMode()==="LineMode"?"links":"tiles";this.currentArea=this.startArea;this.thisLayout.initDragMode();if(this.isLinkPersonalizationSupported){this.LinkDropMarker=this._getLinkDropMarkerElement()}},_getLinkDropMarkerElement:function(){var t=document.createElement("DIV");var e=document.createElement("DIV");var i=document.createElement("DIV");t.setAttribute("id","sapUshellLinkDropMarker");e.setAttribute("id","sapUshellLinkDropMarkerDot");i.setAttribute("id","sapUshellLinkDropMarkerLine");t.appendChild(e);t.appendChild(i);return t},isAreaChanged:function(){return this.currentArea&&this.endArea?this.currentArea!==this.endArea:false},isOriginalAreaChanged:function(){return this.startArea&&this.endArea?this.startArea!==this.endArea:false},_getDestinationIndex:function(t){if(t==="links"){if(this.intersectedLink){var e=this.endGroup.getLinks().indexOf(this.intersectedLink.link);var i=this.endGroup.getLinks().indexOf(this.item);if(this.intersectedLink.leftSide){e=this.rightToLeft?e+1:e-1}if(i<0||i>e){e=this.rightToLeft?e:e+1}return e}return this.endGroup.getLinks().length}return this._getDestinationTileIndex()},layoutEndCallback:function(){var t;var e;var i;this._removeLinkDropMarker();if(this.endArea!=="links"&&!this.tiles){return{tile:this.item}}e=this._getDragSourceGroup();if(!l.isTabBarActive()||!this.bIsTabBarCollision){this.targetGroup=""}i=this._getDestGroupObject(this.targetGroup);t={srcGroup:e,dstGroup:i,dstGroupData:this._getDropTargetGroup(),tile:this.item,dstTileIndex:this._getDestinationIndex(this.endArea),tileMovedFlag:true,srcArea:this.startArea,dstArea:this.bIsTabBarCollision?undefined:this.endArea};return t},_getDestGroupObject:function(t){return t?i.byId(t.getAttribute("id")):this.endGroup},_getDragSourceGroup:function(){var t;t=this.startGroup;if(this.thisLayout.isTabBarActive()&&this.groupSwitched===true){t={groupId:this.sDragStartGroupModelId}}return t},_getDropTargetGroup:function(){var t;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t={groupId:this.sDragTargetGroupModelId}}else{t=this.endGroup}return t},_getDestinationTileIndex:function(){var t;var e;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t=this._getDropTargetGroup().groupId;e=this._getModelGroupById(t);return e.tiles.length}return this.tiles.indexOf(this.item)},compareArrays:function(t,e){if(t.length!==e.length){return false}for(var i=0;i<t.length;i++){if(t[i]!==e[i]){return false}}return true},reorderTilesView:function(t){this.tiles=t;this.matrix=this.thisLayout.organizeGroup(t)},changeTilesOrder:function(t,e,i,r){var s=i.slice(0);var n=s.indexOf(t);var o;var a;var l;if(n>-1){s.splice(n,1)}if(e){s.splice(s.indexOf(e),0,this.item)}else{s.push(t)}if(this.currentGroup==this.endGroup){if(this.compareArrays(i,s)){return false}o=this.thisLayout.organizeGroup(s);a=this.thisLayout.getTilePositionInMatrix(t,r);l=this.thisLayout.getTilePositionInMatrix(t,o);if(a.row==l.row&&a.col==l.col){return false}}this.tiles=s;this.currentGroup=this.endGroup;return s},setMatrix:function(t){this.matrix=t},findTileToPlaceAfter:function(t,e){var i=this.thisLayout.rightToLeft?0:this.curTouchMatrixCords.column;var r=this.thisLayout.rightToLeft?1:-1;var s=0;var n;var o;var a;var l=t[0].length;for(n=this.curTouchMatrixCords.row;n>=0;n--){for(o=i;o>=0&&o<l;o+=r){if(!t[n]||typeof t[n][o]!=="object"){continue}a=e.indexOf(t[n][o]);s=a>s?a:s}i=t[0].length-1}return s||e.length-1},_isElementCollideByGivenCordinates:function(t,e,i){var r=t.getBoundingClientRect();var s=false;var n=false;if(r.height===0&&!t.classList.contains("sapUshellNoLinksAreaPresent")){r=t.parentNode.getBoundingClientRect()}s=r.right>=e&&r.left<=e;n=r.bottom>=i&&r.top<=i;return s&&n},_getMatrixCordinatesOfTouchedTile:function(e,i,r){var s=t({},this.curTouchMatrixCords);var n=e.getInnerContainersDomRefs()[0].getBoundingClientRect();this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(e));var o=this.rightToLeft?n.right+-1*i:n.left*-1+i;var a=(n.top*-1+r)/(this.tileHeight+this.tileMargin);var l=o/(this.tileWidth+this.tileMargin);s={row:Math.floor(a),column:Math.floor(l)};return s},_getCollidedGroup:function(t,e){for(var i=0;i<this.groupsList.length;i++){var r=this.groupsList[i];var s=r.getInnerContainersDomRefs();if(!s){continue}for(var n=0;n<s.length;n++){if(s[n]&&this._isElementCollideByGivenCordinates(s[n],t,e)){var o=!r.groupHasTiles();for(var a=this.groupsList.length-1;a>=i;a--){if(o){break}if(!this.groupsList[a].groupHasTiles()){var l=this.groupsList[a].$();if(!l.hasClass("sapUshellInDragMode")){continue}l.find(".sapUshellInner").removeAttr("style")}}return r}}}},_handleTileAreaIntersection:function(e,i,r){var s=this._getMatrixCordinatesOfTouchedTile(e,i,r);if(e===this.endGroup&&s.column===this.curTouchMatrixCords.column&&s.row===this.curTouchMatrixCords.row){return false}if(this.rightToLeft){this.collisionLeft=this.curTouchMatrixCords.column-s.column>0}else{this.collisionLeft=s.column-this.curTouchMatrixCords.column>0}if(s.column===this.curTouchMatrixCords.column){this.collisionLeft=false}t(this.curTouchMatrixCords,s);return true},_getGroupCollisionObject:function(t,e){var i;var r;i=this._getCollidedGroup(t,e);if(!i||i.getIsGroupLocked()){return undefined}r=this._isLinkAreaIntersection(i,t,e);this.endGroup=i;if(!this.tiles){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}this.endArea=r?"links":"tiles";this.endAreaChanged=this.isAreaChanged();this.currentArea=this.endArea;return{collidedObjectType:r?"Group-link":"Group-tile",collidedObject:i}},getCollisionObject:function(t,e){if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}if(this.thisLayout.isTabBarActive()&&this._isTabBarCollision(e)){return{collidedObjectType:"TabBar"}}return this._getGroupCollisionObject(t,e)},_isTabBarScrollArea:function(t){var e=s("#anchorNavigationBar").height()||0;var i=s("#anchorNavigationBar").offset();var r=i?i.top:0;var n=e+r;return e>0&&t>n&&t<n+30},_cancelLongDropTimmer:function(){clearTimeout(this.thisLayout.oTabBarItemClickTimer)},_isTabBarCollision:function(t){var e=s("#anchorNavigationBar").height()||0;var i=s("#anchorNavigationBar").offset();var r=i?i.top:0;return t<e+r&&t>r},_handleTabBarCollision:function(t,e){var r=this._getTabBarHoverItem(t,e);if(l.isTabBarActive()){this._toggleTileCloneHoverOpacity(true)}this.lastHighlitedTabItem=r;this.thisLayout.setOnTabBarElement(true);var s=this._handleOverflowCollision(t);if(s){return}if(!r){return}this.targetGroup=r;this.sDragTargetGroupModelId=r.getAttribute("modelGroupId");var n=this._getTabBarGroupIndexByModelId(this.sDragTargetGroupModelId);if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}var o=this._getModelGroupById(this._getDropTargetGroup().groupId);if(o.isGroupLocked){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();return}this._toggleAnchorItemHighlighting(true);if(!this.sDragStartGroupModelId){this.sDragStartGroupModelId=this.startGroup.getGroupId()}this.thisLayout.oTabBarItemClickTimer=setTimeout(function(){var t=this._getSelectedTabBarItem();if(this.lastHighlitedTabItem===t){return}this.draggedTileModelPath=this.item.getBindingContext().getPath();this._prepareDomForDragAndDrop();this.startGroup.removeAggregation("tiles",this.item,true);var e=this.sDragStartGroupModelId===this.sDragTargetGroupModelId;this.item.getBindingContext().oModel.setProperty(this.draggedTileModelPath+"/draggedInTabBarToSourceGroup",e);this.groupSwitched=true;i.getEventBus().publish("launchpad","switchTabBarItem",{iGroupIndex:n});var r=this.thisLayout.getGroups();this.endGroup=r[0];this.bElapseGroupLinksMap=true}.bind(this),800);if(this.tiles===null&&this.endGroup){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}var a=document.getElementsByClassName("sapUshellTabBarHoverOn");for(var h=a.length-1;h>=0;--h){a[h].classList.remove("sapUshellTabBarHoverOn")}r.classList.add("sapUshellTabBarHoverOn");return true},_prepareDomForDragAndDrop:function(){var t=this.item.getDomRef();if(r.system.tablet){var e=t.cloneNode(true);var i=t.parentNode;this.origItemId=t.getAttribute("id");this.origItemDataSapUi=t.getAttribute("data-sap-ui");t.removeAttribute("id");t.removeAttribute("data-sap-ui");t.style.display="none";e.style.display="none";var s=document.getElementById("dashboardGroups");s.parentNode.appendChild(t);i.appendChild(e);this.draggedTileDomRef=t}else if(!this.draggedTileDomRef){this.draggedTileDomRef=t}},_appendTargetGroupDomRefWithDraggedTile:function(){var t=this.endGroup.getInnerContainerDomRefs()?this.endGroup.getInnerContainerDomRefs()[0]:null;if(!this.item.getDomRef()){if(r.system.tablet){this.draggedTileDomRef.setAttribute("id",this.origItemId);this.draggedTileDomRef.setAttribute("data-sap-ui",this.origItemDataSapUi);this.draggedTileDomRef.style.display=""}if(t){t.appendChild(this.draggedTileDomRef)}}else{if(t){t.appendChild(this.item.getDomRef())}if(r.system.tablet){this.item.getDomRef().style.display=""}}},_getSelectedTabBarItem:function(){return document.getElementsByClassName("sapUshellAnchorItemSelected")[0]},_getTabBarGroupIndexByModelId:function(t){var e;for(var i=0;i<this.allGroups.length;++i){e=this.allGroups[i].groupId;if(t===e){return i}}},_getModelGroupById:function(t){var e=this.thisLayout.getAllGroups();var i;var r;for(var s=0;s<e.length;++s){i=e[s];r=i.groupId;if(r===t){return i}}},_handleOverflowCollision:function(t){var e=i.byId("anchorNavigationBar");var r=this._calculateOverflowButtonSideCollision(t);if(r=="right"){if(!this.tabBarArrowCollisionRight){e._scrollToGroupByGroupIndex(e.anchorItems.length-1,5e3);this.tabBarArrowCollisionRight=true}return true}else if(r=="left"){if(!this.tabBarArrowCollisionLeft){e._scrollToGroupByGroupIndex(0,5e3);this.tabBarArrowCollisionLeft=true}return true}this._resetOverFlowButtonElements();return false},_calculateOverflowButtonSideCollision:function(t){var e=s(".sapUshellAnchorRightOverFlowButton");var i=e.offset().left;var r=s(".sapUshellAnchorItemOverFlow");var n=r.offset().left;var o=s(".sapUshellAnchorLeftOverFlowButton");var a=o.offset().left;var l=32;var h=s("#anchorNavigationBar");var u=h.offset().left;if(t>i&&t<n){return"right"}if(t>u&&t<a+l){return"left"}},_resetOverFlowButtonElements:function(){var t=r.system.tablet;var e=s(t?".sapUshellAnchorNavigationBarItemsScroll":".sapUshellAnchorNavigationBarItems");e.stop();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false},_toggleTabBarOverflowArrows:function(t){var e=document.getElementsByClassName("sapUshellAnchorRightOverFlowButton");var i=document.getElementsByClassName("sapUshellAnchorLeftOverFlowButton");for(var r=0;r<e.length;++r){e[r].classList.toggle("sapUshellTabBarOverflowButton",t)}for(var s=0;s<i.length;++s){i[s].classList.toggle("sapUshellTabBarOverflowButton",t)}},_getTabBarHoverItem:function(t,e){var i=s(".sapUshellAnchorItem:not(.sapUshellShellHidden)").eq(0).offset().left;if(t-i<=0){return}var r=Math.round((t-i)/10);if(r>=e.length){r=e.length-1}var n=e[r];var o=document.getElementsByClassName("sapUshellAnchorItem");return o[n]},removeExcludedElementsFromMatrix:function(t){if(!t.length){return}if(!this.matrix){return}var e=this.matrix.map(function(e){return e.map(function(e){var i=t.some(function(t){return e instanceof t});return i?undefined:e})});this.setMatrix(e)},setExcludedControl:function(t){if(t){this.aExcludedControlClass.push(t)}},setReorderTilesCallback:function(t){if(typeof t==="function"){this.reorderElementsCallback=t}}};var a=function(){};a.prototype={_initDeferred:s.Deferred(),init:function(t){var e=function(){var t=this.container&&this.container.getAttribute("id")||"";if(t.includes("destroyed")){return}var i=this.getStyleInfo(this.container);if(i.tileWidth>0){this.isInited=true;this.reRenderGroupsLayout();this.layoutEngine=new o({thisLayout:this});this._initDeferred.resolve();return}setTimeout(e,100)}.bind(this);this.cfg=t||this.cfg;this.minTilesinRow=2;this.container=this.cfg.container||document.getElementById("dashboardGroups");this.oTabBarItemClickTimer=new Date;this.bTabBarModeActive=false;this.bOnTabBarElement=false;if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("LaunchPage").then(function(t){this.oLaunchPageService=t;e()}.bind(this))}else{e()}i.getEventBus().subscribe("launchpad","tabBarChange",this._onTabBarChange,this);return this.getInitPromise()},setOnTabBarElement:function(t){this.bOnTabBarElement=t},isOnTabBarElement:function(){return this.bOnTabBarElement},_onTabBarChange:function(t,e,i){if(i==="tabs"){this.bTabBarModeActive=true}else{this.bTabBarModeActive=false}},tabBarTileDropped:function(){if(this.oTabBarItemClickTimer){clearTimeout(this.oTabBarItemClickTimer)}},getInitPromise:function(){return this._initDeferred.promise()},getLayoutEngine:function(){return this.layoutEngine},getStyleInfo:function(t){var e=document.createElement("div");var i=t.getAttribute("id");t=i?document.getElementById(i):t;e.className="sapUshellTile";var r=n.last("/core/home/sizeBehavior");if(r==="Small"){e.classList.add("sapUshellSmall")}e.style.position="absolute";e.style.visibility="hidden";t.appendChild(e);var s=window.getComputedStyle(e);var o=window.getComputedStyle(t);var a={tileMarginHeight:parseFloat(s.marginBottom,10)+parseFloat(s.marginTop,10),tileMarginWidth:parseFloat(s.marginLeft,10)+parseFloat(s.marginRight,10),tileWidth:e.offsetWidth,tileHeight:e.offsetHeight,containerWidth:o.width?parseInt(o.width,10):t.offsetWidth};t.removeChild(e);return a},getGroups:function(){return this.cfg.getGroups()},getAllGroups:function(){return this.cfg.getAllGroups?this.cfg.getAllGroups():[]},isTabBarActive:function(){return this.cfg.isTabBarActive?this.cfg.isTabBarActive():false},getTilesInRow:function(){return this.tilesInRow},setTilesInRow:function(t){this.tilesInRow=t},checkPlaceForTile:function(e,i,r,s,n){if(typeof i[r.y]==="undefined"){i.push(new Array(i[0].length))}if(typeof i[r.y+1]==="undefined"){i.push(new Array(i[0].length))}if(typeof i[r.y][r.x]!=="undefined"){return false}var o=t({},r);if(n||e&&e.getLong&&!e.getLong()){return[o]}var a=[o];if(e&&e.getLong&&e.getLong()){if(r.x+1>=i[0].length||typeof i[o.y][o.x+1]!=="undefined"){return false}a.push({y:o.y,x:o.x+1})}return a},placeTile:function(t,e,i){for(var r=0;r<i.length;r++){e[i[r].y][i[r].x]=t}},getTilePositionInMatrix:function(t,e){for(var i=0;i<e.length;i++){for(var r=0;r<e[i].length;r++){if(e[i][r]===t){return{row:i,col:r}}}}return false},fillRowsInLine:function(t,e,i,r){if(!e.length){return 0}var s;for(var n=0;n<t[0].length&&e.length;n++){s=this.checkPlaceForTile(e[0],t,{x:n,y:i},r);if(s){this.placeTile(e[0],t,s);e.shift()}}},organizeGroup:function(t,e){var i=t.slice(0);var r=[];var s=0;r.push(new Array(e?Math.floor(this.tilesInRow/2):this.tilesInRow));while(i.length){this.fillRowsInLine(r,i,s,e);s++}if(this.rightToLeft){for(var n=0;n<r.length;n++){r[n].reverse()}}r=this.cleanRows(r);return r},cleanRows:function(t){var e=false;for(var i=t.length-1;i>0&&!e;i--){for(var r=0;r<t[i].length&&!e;r++){if(typeof t[i][r]==="object"){e=true}}if(!e){t.pop()}}return t},setGroupsLayout:function(t,e){if(t.getIsGroupLocked()&&e.length>0){var i=t.getDomRef().parentElement;t.getDomRef().style.width="";i.style.width="";i.style.display=""}},calcTilesInRow:function(t,e,i){var r=Math.floor(t/(e+i));r=r<this.minTilesinRow?this.minTilesinRow:r;return r},getGroupTiles:function(t){var e=t.getTiles();if(t.getShowPlaceholder()){e.push(t.oPlusTile)}return e},reRenderGroupsLayout:function(t){if(!this.isInited){return}var e=this.getStyleInfo(this.container);if(!e.tileWidth){return}this.styleInfo=e;this.tilesInRow=this.calcTilesInRow(e.containerWidth,e.tileWidth,e.tileMarginWidth);t=t||this.getGroups();for(var i=0;i<t.length;i++){if(t[i].getDomRef&&!t[i].getDomRef()){continue}var r=this.getGroupTiles(t[i]);var s=this.organizeGroup(r);this.setGroupsLayout(t[i],s)}},initDragMode:function(){this.initGroupDragMode(this.layoutEngine.currentGroup)},endDragMode:function(){var t=this.getGroups();for(var e=0;e<t.length;e++){var i=t[e].$();if(!i.hasClass("sapUshellInDragMode")){continue}i.removeClass("sapUshellInDragMode");var r=this.getGroupTiles(t[e]);for(var s=0;s<r.length;s++){r[s].$().removeAttr("style")}i.find(".sapUshellInner").removeAttr("style")}},initGroupDragMode:function(t){if(t.$().hasClass("sapUshellInDragMode")){return}var e=this.getGroupTiles(t);var i=this.organizeGroup(e);t.$().addClass("sapUshellInDragMode");this.renderLayoutGroup(t,i)},calcTranslate:function(t,e){var i=e*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth);var r=t*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight);if(this.layoutEngine.rightToLeft){i=-i}return{x:i,y:r}},renderLayoutGroup:function(t,e){var i;this.styleInfo=this.getStyleInfo(this.container);for(var r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++){if(i===e[r][s]){continue}else{i=e[r][s]}if(typeof i==="undefined"){break}}}}};var l=new a;return l},false);
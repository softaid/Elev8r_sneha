// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/assert","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/base/ManagedObject","sap/ui/integration/util/DataProviderFactory","sap/ushell/components/cepsearchresult/util/SearchResultModel"],function(e,t,r,a,o,s,i){"use strict";var n=null;var l=null;var u={};var c={"/categories":["/title","/shortTitle","/card/title","/card/subTitle","/list/noDataText","/list/loadingDataText"]};var p=o.extend("sap.ushell.components.cepsearchresult.util.SimpleControl",{metadata:{properties:{resolved:{type:"string"}}}});var d=new p;var g=function(e){t(typeof e==="string"&&(e==="standard"||e==="advanced"),"Edition must be a string: 'standard' or 'advanced'");if(!e){e="standard"}this.oDataProviderFactory=new s;this.sEdition=e;this._createModel(e)};g.prototype.getModel=function(){return this.oModel};g.prototype.getCategoriesModel=function(e){if(typeof e==="string"){e.replace(/ /gi,"");e=e.split(",")}if(e.length===1){var t=this.getCategory(e[0]);if(t&&Array.isArray(t.subCategories)){return new r(t.subCategories)}}var a=[];var o=this.getModel().getData();e.forEach(function(e){a.push(o.categoriesMap[e])});return new r(a)};g.prototype.createSearchResultModel=function(e,t,r){var a;var o=r.getData();for(var s=0;s<o.length;s++){if(o[s].name===e){a=new i(JSON.parse(JSON.stringify(o[s])));break}}var n=a.getData();n.list._currentView=n.list._currentView||n.list.defaultView;n._status=n._status||{};n._status.dataStatusText=n.list.loadingDataText;if(n.extension){a.setExtension(new u[n.extension])}if(t){a.setHost(t.getHost());a.setCard(t)}return a};g.prototype.getCategory=function(e){return this.getModel().getProperty("/categoriesMap/"+e)};g.prototype._createResourceModel=function(){if(!n){n=new a({bundleName:"sap.ushell.components.cepsearchresult.util.i18n.i18n"})}this.oResourceModel=n};g.prototype._createModel=function(a){t(typeof a==="string"&&(a==="standard"||a==="advanced"),"Edition must be a string: 'standard' or 'advanced'");this._createResourceModel();if(!l){var o=g._configPath+"/config."+a+".json";l=new r;this._loaded=l.loadData(o).then(function(){if(this.oResourceModel){this._translateModel(l,this.oResourceModel)}this._normalizeCategories();return this._loadExtensions()}.bind(this)).catch(function(){e.error("Could not load search result configuration for "+a+" from "+o,"sap.ushell.components.cepsearchresult.util.SearchResultManager")})}else{this._loaded=Promise.resolve()}this.oModel=l};g.prototype._loadExtensions=function(){var e=l.getProperty("/categories");var t=[];var r=[];e.map(function(e){if(e.extension){r.push(e.extension);t.push(e.extension.replace("module:",""))}});if(r.length===0){return Promise.resolve()}return new Promise(function(e){sap.ui.require(t,function(){var t=Array.from(arguments);t.forEach(function(e,t){u[r[t]]=e});e()})})};g.prototype._normalizeCategories=function(){var e=l.getProperty("/categories");var t={};e.map(function(e){t[e.name]=e});l.setProperty("/categoriesMap",t);e.map(function(e){var r=e.subCategories;var a=[];if(Array.isArray(r)){for(var o=0;o<r.length;o++){var s=r[o];var i=t[e.subCategories[o].name];if(!i){continue}var n=JSON.parse(JSON.stringify(i));if(s.pageSize&&n.list&&n.list.paginator){n.list.paginator.pageSize=s.pageSize}a.push(n)}e.subCategories=a}})};g.prototype._translateModel=function(e,t){d.setModel(t,"i18n");for(var r in c){var a=e.getProperty(r);if(Array.isArray(a)){for(var o=0;o<a.length;o++){for(var s=0;s<c[r].length;s++){d.applySettings({resolved:e.getProperty(r+"/"+o+c[r][s])});e.setProperty(r+"/"+o+c[r][s],d.getResolved())}}}}d.setModel(null,"i18n")};g._resetGlobals=function(){n=null;l=null;u={}};g._configPath=sap.ui.require.toUrl("sap/ushell/components/cepsearchresult/util");return g});
//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/resource/ResourceModel","./controls/SearchResultList"],function(e,t,a){"use strict";var r=new a({noDataText:"{category>_status/dataStatusText}",category:"{category>}",paging:"{= ${category>list/paging}}",view:"{category>list/_currentView}",items:"{path:'data>'}",itemFragment:"{= ${category>list/item/fragment} || 'default'}"});return e.extend("sap.ushell.components.cepsearchresult.cards.searchresultwidget.Main",{onInit:function(){this.oView=this.getView();var e=this.getOwnerComponent();this.oCard=e.oCard;this.oResourceModel=new t({bundleName:"sap.ushell.components.cepsearchresult.cards.searchresultwidget.i18n.i18n"});this.oView.setModel(this.oResourceModel,"card_i18n");this.oView.setModel(this.oCard.getModel("parameters"),"parameters");this.mCardParameters=e.mCardParameters;this.sSearchTerm=this.mCardParameters.searchTerm;this.oSearchResultManager=e.oSearchResultManager;this.oSearchResultManager._loaded.then(this.initUIAsync.bind(this))},initUIAsync:function(){this.oCategoriesModel=this.oSearchResultManager.getCategoriesModel(this.mCardParameters.categories);this.oCategoriesModel.getProperty("/").forEach(function(e,t){var a=this.oSearchResultManager.createSearchResultModel(e.name,this.oCard,this.oCategoriesModel);var r=this._createList(e.name,a);this.oView.byId("content").addItem(r)}.bind(this));this.oView.setVisible(true)},_createList:function(e,t){var a=r.clone(e,"",{cloneBindings:true});a.applyModelContexts(t,{category:"/",data:"/list/data/_result",count:"/list/data/_count"});a.attachItemPress(function(e){var t=e.getParameter("listItem").getBindingContext("data").getProperty("url");document.location.hash=t});a.attachFetchData(function(e){var a=e.getParameters();t.setProperty("/list/paginator/pageSize",a.pageSize);t.fetchCategoryData(a.page)});a.loadForVisibleItemCount(t.getProperty("/list/paginator/pageSize"),this.oCard.getDomRef());return a}})});
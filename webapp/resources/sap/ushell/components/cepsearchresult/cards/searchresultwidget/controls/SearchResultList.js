/*!
 * Copyright (c) 2009-2022 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/m/List","sap/m/ListRenderer","sap/m/CustomListItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Title","sap/ui/core/ResizeHandler","sap/ui/Device","sap/ui/dom/includeStylesheet","sap/ushell/components/cepsearchresult/util/appendStyleVars","sap/ui/core/Fragment","./Paginator","sap/m/Text","sap/ushell/services/VisualizationInstantiation"],function(e,t,i,s,a,o,n,r,l,h,p,g,d,u,m,c){"use strict";g(["sapUiShadowLevel0","sapUiShadowLevel1","sapUiBaseText","sapUiContentLabelColor","sapUiElementBorderCornerRadius","sapMFontMediumSize","sapUiListBorderColor","sapMFontHeader4Size","sapMFontMediumSize"]);p(sap.ui.require.toUrl("sap/ushell/components/cepsearchresult/cards/searchresultwidget/controls/SearchResultList.css"));var f=document.createElement("span");f.classList.add("sapMGT","OneByOne");f.style.position="absolute";f.style.top="0";document.body.appendChild(f);var C=f.offsetWidth+5;f.remove();var y=new s({style:"Clear",content:[new a({width:"0.5rem"}),new r({text:"{category>title} ({= ${count>}})",level:"H1"}),new a,new o({selectedKey:"{category>list/_currentView}",visible:"{= ${category>list/views}.length > -1}",items:[new n({icon:"sap-icon://text-align-justified",key:"List",visible:"{= ${category>list/views}.indexOf('List') > -1}"}),new n({icon:"sap-icon://filter-facets",key:"TwoColumn",visible:"{= ${category>list/views}.indexOf('TwoColumn') > -1}"}),new n({icon:"sap-icon://grid",key:"Tile",visible:"{= ${category>list/views}.indexOf('Tile') > -1}"}),new n({icon:"sap-icon://business-card",key:"Card",visible:"{= ${category>list/views}.indexOf('Card') > -1}"})]}),new a({width:"1rem"})]});var w=new s({style:"Clear",content:[new a({width:"1rem"}),new m({text:"Found {= ${count>}} items"}),new a,new u({visible:"{= ${count>} > ${category>list/paginator/pageSize}}",count:"{= ${count>} || 0}",pageSize:"{category>list/paginator/pageSize}",currentPage:"{category>list/paginator/currentPage}"}),new a({width:"1rem"})]});w.addStyleClass("sapUiSmallMarginBottom");w.addStyleClass("sapUiSmallMarginTop");var v=new c;var S=e.extend("sap.ushell.components.cepsearchresult.cards.searchresultwidget.controls.SearchResultList",{metadata:{properties:{category:{type:"object"},paging:{type:"boolean",defaultValue:true},viewAll:{type:"boolean",defaultValue:false},view:{type:"string",defaultValue:"List"},itemFragment:{type:"string",defaultValue:"default"}},aggregations:{_footer:{type:"sap.m.OverflowToolbar",multiple:false,hidden:true}},events:{selectPage:{},fetchData:{}}},renderer:function(e,i){t.render(e,i);if(i.getPaging()||i.getViewAll()){e.renderControl(i.getAggregation("_footer"))}}});S.prototype.init=function(){this.addStyleClass("sapUiCEPCatList");this._initToolbar();this._initFooterBar();this._sViewHeight="unset"};S.prototype._initToolbar=function(){this.setHeaderToolbar(y.clone())};S.prototype._initFooterBar=function(){var e=w.clone();e.getContent()[3].attachSelectPage(this.handleSelectPage.bind(this));this.setAggregation("_footer",e)};S.prototype._initItemFragment=function(){if(!this.oItemFragmentPromise){this.oItemFragmentPromise=d.load({type:"XML",name:"sap.ushell.components.cepsearchresult.cards.searchresultwidget.controls."+this.getItemFragment(),controller:this}).then(function(e){this.oItemFragment=e}.bind(this))}return this.oItemFragmentPromise};S.prototype.bindAggregation=function(t,s){if(t==="items"){this._initItemFragment().then(function(){this.updateItems()}.bind(this));s.factory=function(e,t){var s=t.getProperty("_viz");if(s&&this.getView()==="Tile"){var a=new i;a.addStyleClass("sapUiCEPCatTileInstance");a.addContent(v.instantiateVisualization(s));return a}else if(this.oItemFragment){return this.oItemFragment.clone(e)}return new i}.bind(this)}return e.prototype.bindAggregation.apply(this,[t,s])};S.prototype._getCurrentColCount=function(){if(this.getDomRef()){var e=this.getDomRef().querySelectorAll(".sapMListItems > LI");var t=1;var i=e[0].offsetTop;for(var s=1;s<e.length;s++){if(e[s].offsetTop<=i){t=t+1}else{break}}return t}};S.prototype._startItemNavigation=function(){e.prototype._startItemNavigation.apply(this,[false]);if(this._oItemNavigation){if(this.getView()==="Tile"){this._oItemNavigation.setItemDomRefs(Array.from(this.getDomRef().querySelectorAll(".sapMGT")))}this._oItemNavigation.setTableMode(false,true).setColumns(this._getCurrentColCount())}};S.prototype.setView=function(e){var t=this.getProperty("view");this.setProperty("view",e);this.removeStyleClass("sapUiCEPCatListCard");this.removeStyleClass("sapUiCEPCatListTile");this.removeStyleClass("sapUiCEPCatListTwoColumn");switch(e){case"Card":this.addStyleClass("sapUiCEPCatListCard");break;case"Tile":this.addStyleClass("sapUiCEPCatListTile");break;case"TwoColumn":this.addStyleClass("sapUiCEPCatListTwoColumn");break;default:}if(this._iGivenPageSize&&this.getDomRef()&&this.getDomRef().offsetWidth){this.loadForVisibleItemCount(this._iGivenPageSize,this.getDomRef())}if(e&&t!==e){this._sViewHeight="unset"}this.updateItems();return this};S.prototype.loadForVisibleItemCount=function(e,t){this._iGivenPageSize=e;this._iCurrentPageSize=e;var i,s;if(this.getView()==="Tile"&&t){i=Math.floor((t.offsetWidth-20)/(C+20));s=Math.ceil(e/i);this._iCurrentPageSize=s*i}if(this.getView()==="Card"&&t){i=Math.min(Math.floor((t.offsetWidth-20)/300),3);s=Math.ceil(e/i);this._iCurrentPageSize=s*i}if(this.getView()==="TwoColumn"){if(t.offsetWidth<600){this.removeStyleClass("sapUiCEPCatListTwoColumn")}else{this.addStyleClass("sapUiCEPCatListTwoColumn")}}this.fireFetchData({page:1,pageSize:this._iCurrentPageSize})};S.prototype.handleSelectPage=function(e){this._sViewHeight=this.getDomRef().offsetHeight+"px";this.fireFetchData({page:e.getParameter("page"),pageSize:this._iCurrentPageSize})};S.prototype._onResize=function(e){if(this._oItemNavigation){this._oItemNavigation.setColumns(this._getCurrentColCount())}var t=this.getView();if(t==="Tile"&&e.size&&e.oldSize&&Math.abs(e.size.width-e.oldSize.width)>C){this.loadForVisibleItemCount(this._iGivenPageSize,this.getDomRef());this._sViewHeight="unset";this.getDomRef().style.height=this._sViewHeight}else if(t==="TwoColumn"){if(e.size&&e.size.width<600){this.removeStyleClass("sapUiCEPCatListTwoColumn")}else{this.addStyleClass("sapUiCEPCatList")}}};S.prototype.applyModelContexts=function(e,t){for(var i in t){this.setModel(e,i);this.setElementBindingContext(e.createBindingContext(t[i]),i)}};S.prototype.itemNavigate=function(e){var t=e.getSource();while(t.getParent()){if(t.getParent()===this){this.fireItemPress({listItem:t,srcControl:e.getSource()});break}t=t.getParent()}};S.prototype.onBeforeRendering=function(){if(this._iResizeListenerId){h.resize.detachHandler(this._fnResizeListener);l.deregister(this._iResizeListenerId);this._iResizeListenerId=null}if(this.getDomRef()){this.getDomRef().nextElementSibling.remove()}if(this.getItems().length>0){this.removeStyleClass("sapUiCEPCatListNoData")}else{this.addStyleClass("sapUiCEPCatListNoData")}e.prototype.onBeforeRendering.apply(this,arguments)};S.prototype.onAfterRendering=function(){if(!this._iResizeListenerId){this._fnResizeListener=this._onResize.bind(this);h.resize.attachHandler(this._fnResizeListener);this._iResizeListenerId=l.register(this,this._fnResizeListener)}e.prototype.onAfterRendering.apply(this,arguments);this.getDomRef().style.height=this._sViewHeight};return S});
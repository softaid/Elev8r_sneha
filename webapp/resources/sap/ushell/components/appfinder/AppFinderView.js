// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/View","sap/ui/thirdparty/jquery","sap/ui/core/ListItem","sap/ui/model/Sorter","sap/m/MultiComboBox","sap/ui/model/BindingMode","sap/m/SearchField","sap/m/FlexBox","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/ToggleButton","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/Toolbar","sap/m/Page","sap/ushell/resources","sap/ui/Device"],function(e,t,n,o,a,s,r,i,l,p,u,d,h,c,g,S){"use strict";return e.extend("sap.ushell.components.appfinder.AppFinderView",{createContent:function(){var e=g.i18n;this.oPage=new c("appFinderPage",{showHeader:false,showSubHeader:false,showFooter:false,showNavButton:false,enableScrolling:false,title:{parts:["/groupContext/title"],formatter:function(t){return!t?e.getText("appFinderTitle"):e.getText("appFinder_group_context_title",t)}}});return this.oPage},_showSearch:function(e){var t="enableCatalogSearch";if(e==="userMenu"){t="enableEasyAccessUserMenuSearch"}else if(e==="sapMenu"){t="enableEasyAccessSAPMenuSearch"}return this.getModel().getProperty("/"+t)},_showSearchTag:function(e){if(e==="userMenu"||e==="sapMenu"){return false}return this.getModel().getProperty("/enableCatalogTagFilter")},createSubHeader:function(){this.oToolbar=new h("appFinderSubHeader",{});if(S.system.desktop){this.oToolbar.addEventDelegate({onAfterRendering:function(){t("#catalog-button").attr("accesskey","a")}})}this.oToolbar.addStyleClass("sapUshellAppFinderHeader");this.oPage.setSubHeader(this.oToolbar);this.oPage.setShowSubHeader(true);if(!this.openCloseSplitAppButton){this.openCloseSplitAppButton=new u("openCloseButtonAppFinderSubheader",{icon:"sap-icon://menu2",visible:"{/openCloseSplitAppButtonVisible}",pressed:"{/openCloseSplitAppButtonToggled}",press:function(e){this.getController().oSubHeaderModel.setProperty("/openCloseSplitAppButtonToggled",e.getSource().getPressed());this.openCloseSplitAppButton.setTooltip(e.getParameter("pressed")?g.i18n.getText("ToggleButtonHide"):g.i18n.getText("ToggleButtonShow"))}.bind(this),tooltip:g.i18n.getText("ToggleButtonShow")});this.openCloseSplitAppButton.setModel(this.getController().oSubHeaderModel);this.oToolbar.addContent(this.openCloseSplitAppButton)}},updateSubHeader:function(e,t){var n,o;this.oToolbar.removeAllContent();this.oToolbar.addContent(this.openCloseSplitAppButton);if(t){n=this.createSegmentedButtons(e);this.oPage.addStyleClass("sapUshellAppFinderWithEasyAccess");this.oToolbar.addContent(n)}if(this._showSearch(e)){o=this.createSearchControl(e);this.oToolbar.addContent(o)}this.getController()._updateCurrentMenuName(e)},createSegmentedButtons:function(e){var t,n,o,a,s,r;if(this.segmentedButton){this.segmentedButton.setSelectedKey(e);return this.segmentedButton}t=this.getController();n=g.i18n;o=[];o.push(new p("catalog",{text:n.getText("appFinderCatalogTitle"),key:"catalog",press:function(e){t.onSegmentButtonClick(e)}}));if(t.bEnableEasyAccessUserMenu){o.push(new p("userMenu",{text:n.getText("appFinderUserMenuTitle"),key:"userMenu",press:function(e){t.onSegmentButtonClick(e)}}))}if(t.bEnableEasyAccessSAPMenu){o.push(new p("sapMenu",{text:n.getText("appFinderSapMenuTitle"),key:"sapMenu",press:function(e){t.onSegmentButtonClick(e)}}))}this.segmentedButton=new l("appFinderSegmentedButtons",{items:o});this.segmentedButton.setSelectedKey(e);a=this.segmentedButton.getItems();for(r=0;r<a.length;r++){s=a[r];s.addCustomData(new d({key:"aria-controls",value:s.getId()+"View",writeToDom:true}))}return this.segmentedButton},_handleSearch:function(){this.getController().searchHandler.apply(this.getController(),arguments);t("#appFinderSearch input").select()},createSearchControl:function(e){if(!this.oAppFinderSearchContainer){this.oAppFinderSearchContainer=new i("appFinderSearchContainer")}this.oAppFinderSearchContainer.removeAllItems();if(e==="catalog"&&this._showSearchTag("catalog")){this.oAppFinderSearchContainer.addItem(this.createTagControl())}if(!this.oAppFinderSearchControl){this.oAppFinderSearchControl=new r("appFinderSearch",{search:this._handleSearch.bind(this),value:{path:"subHeaderModel>/search/searchTerm",mode:s.OneWay}}).addStyleClass("help-id-catalogSearch");this.oAppFinderSearchControl.addCustomData(new d({key:"aria-controls",value:"",writeToDom:true}));if(S.system.desktop){sap.ui.require(["sap/ushell/components/ComponentKeysHandler","sap/ushell/renderers/fiori2/AccessKeysHandler"],function(e,t){e.getInstance().then(function(e){this.oAppFinderSearchControl.addEventDelegate({onsaptabnext:function(n){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o.getVisible()&&!o.getPressed()){n.preventDefault();t.setIsFocusHandledByAnotherHandler(true);e.setFocusOnCatalogTile()}}})}.bind(this))}.bind(this))}}this.oAppFinderSearchContainer.addItem(this.oAppFinderSearchControl);this._updateSearchWithPlaceHolder(e);return this.oAppFinderSearchContainer},_updateSearchWithPlaceHolder:function(e){var t="";if(e==="catalog"){t="EasyAccessMenu_SearchPlaceHolder_Catalog"}else if(e==="userMenu"){t="EasyAccessMenu_SearchPlaceHolder_UserMenu"}else if(e==="sapMenu"){t="EasyAccessMenu_SearchPlaceHolder_SAPMenu"}if(t&&this.oAppFinderSearchControl){this.oAppFinderSearchControl.setPlaceholder(g.i18n.getText(t));this.oAppFinderSearchControl.setTooltip(g.i18n.getText(t))}},createTagControl:function(){if(this.oAppFinderTagFilter){return this.oAppFinderTagFilter}var e=this.getController();this.oAppFinderTagFilter=new a("appFinderTagFilter",{selectedKeys:{path:"subHeaderModel>/tag/selectedTags"},tooltip:"{i18n>catalogTilesTagfilter_tooltip}",placeholder:"{i18n>catalogTilesTagfilter_HintText}",visible:{path:"/tagList",formatter:function(e){return e.length>0}},items:{path:"/tagList",sorter:new o("tag",false,false),template:new n({text:"{tag}",key:"{tag}"})},selectionChange:[e.onTagsFilter,e]}).addStyleClass("help-id-catalogTagFilter");return this.oAppFinderTagFilter},getControllerName:function(){return"sap.ushell.components.appfinder.AppFinder"}})});
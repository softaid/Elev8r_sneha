// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/ushell/utils/objectOperations","sap/ushell/utils/UrlParsing"],function(e,t,a,i,s,p){"use strict";function o(e,t){return s.getMember(e,t)}function r(e,a,s){a=t({},a);s=t({},s);var p={};p.semanticObject=a.semanticObject;p.action=a.action;p.title=a.title||o(s,"sap|app.title");p.info=a.info||o(s,"sap|app.info");p.icon=a.icon||o(s,"sap|ui.icons.icon");p.subTitle=a.subTitle||o(s,"sap|app.subTitle");p.shortTitle=a.shortTitle||o(s,"sap|app.shortTitle");var r,n,u,l,c,f,m=false;var d=o(s,"sap|platform|runtime");p.resolutionResult=i.extend(true,{},d);if(d){p.resolutionResult["sap.platform.runtime"]=i.extend(true,{},d)}if(o(s,"sap|ui.technology")==="GUI"){p.resolutionResult["sap.gui"]=o(s,"sap|gui")}if(o(s,"sap|ui.technology")==="WDA"){p.resolutionResult["sap.wda"]=o(s,"sap|wda")}if(o(s,"sap|ui.technology")==="URL"){if(s["sap.url"]){p.resolutionResult["sap.platform.runtime"]=p.resolutionResult["sap.platform.runtime"]||{};p.resolutionResult.url=s["sap.url"].uri;p.resolutionResult["sap.platform.runtime"].url=s["sap.url"].uri}else if(d&&d.uri){p.resolutionResult["sap.platform.runtime"].url=d.uri;p.resolutionResult.url=d.uri}}if(!p.resolutionResult["sap.ui"]){p.resolutionResult["sap.ui"]={}}p.resolutionResult["sap.ui"].technology=o(s,"sap|ui.technology");p.resolutionResult.applicationType=this._formatApplicationType(p.resolutionResult,s);p.resolutionResult.systemAlias=p.resolutionResult.systemAlias||a.systemAlias;p.resolutionResult.systemAliasSemantics="apply";p.resolutionResult.text=p.title;p.deviceTypes=o(s,"sap|ui.deviceTypes")||{};p.resolutionResult.appId=o(s,"sap|app.id");["desktop","tablet","phone"].forEach(function(e){if(Object.prototype.hasOwnProperty.call(a.deviceTypes||{},e)){p.deviceTypes[e]=a.deviceTypes[e]}if(!Object.prototype.hasOwnProperty.call(p.deviceTypes,e)){p.deviceTypes[e]=true}p.deviceTypes[e]=!!p.deviceTypes[e]});p.signature=a.signature||{};p.signature.parameters=p.signature.parameters||{};p.signature.additionalParameters=(a.signature||{}).additionalParameters||"allowed";var y=a.indicatorDataSource||o(s,"sap|app.crossNavigation.inbounds."+e+".indicatorDataSource");var h=y?"#Shell-dynamicTile":"#Shell-staticTile";if(o(s,"sap|app.type")==="tile"||o(s,"sap|flp.type")==="tile"){h=p.resolutionResult;h.url=o(s,"sap|platform|runtime.componentProperties.url");h.componentName=o(s,"sap|ui5.componentName");if(o(s,"sap|platform|runtime.includeManifest")){h.componentProperties=h.componentProperties||{};h.componentProperties.manifest=i.extend(true,{},s);delete h.componentProperties.manifest["sap.platform.runtime"]}l=o(s,"sap|app.crossNavigation.outbounds.target");m=true}if(o(s,"sap|app.type")==="plugin"||o(s,"sap|flp.type")==="plugin"){return undefined}if(o(s,"sap|flp.tileSize")){r=o(s,"sap|flp.tileSize")}if(o(s,"sap|app.description")){n=o(s,"sap|app.description")}if(o(s,"sap|ui.technology")==="GUI"&&o(s,"sap|gui.transaction")){u=o(s,"sap|gui.transaction")}if(o(s,"sap|ui.technology")==="WDA"&&o(s,"sap|wda.applicationId")){u=o(s,"sap|wda.applicationId")}if(o(s,"sap|app.dataSources")){c=o(s,"sap|app.dataSources")}if(o(s,"sap|app.id")){f=o(s,"sap|app.id")}p.tileResolutionResult={appId:f,title:p.title,subTitle:p.subTitle,icon:p.icon,size:r,info:p.info,tileComponentLoadInfo:h,indicatorDataSource:y,dataSources:c,description:n,runtimeInformation:d,technicalInformation:u,deviceTypes:p.deviceTypes};p.tileResolutionResult.isCustomTile=m;if(l){p.tileResolutionResult.targetOutbound=l}return p}function n(e,t){var a=e.applicationType;if(a){return a}var i=o(t,"sap|platform|runtime.componentProperties.self.name")||o(t,"sap|ui5.componentName");if(o(t,"sap|flp.appType")==="UI5"||o(t,"sap|ui.technology")==="UI5"){e.applicationType="SAPUI5";e.additionalInformation="SAPUI5.Component="+i;e.url=o(t,"sap|platform|runtime.componentProperties.url");e.applicationDependencies=o(t,"sap|platform|runtime.componentProperties");return"SAPUI5"}if(o(t,"sap|ui.technology")==="GUI"){e.applicationType="TR";e["sap.gui"]=o(t,"sap|gui");e.systemAlias=o(t,"sap|app.destination.name");return"TR"}if(o(t,"sap|ui.technology")==="WDA"){e.applicationType="WDA";e["sap.wda"]=o(t,"sap|wda");e.systemAlias=o(t,"sap|app.destination.name");return"WDA"}if(o(t,"sap|ui.technology")==="URL"){e.applicationType="URL";e.systemAlias=o(t,"sap|app.destination.name")}return"URL"}function u(t){var a=this;if(!t){return[]}var i=[];try{var s=Object.keys(t.applications||{}).sort();s.forEach(function(s){try{var p=t.applications[s];var r=o(p,"sap|app.crossNavigation.inbounds");if(r){var n=Object.keys(r).sort();n.forEach(function(e){var t=r[e];var s=a.mapOne(e,t,p);if(s){i.push(s)}})}}catch(t){e.error("Error in application "+s+": "+t,t.stack)}})}catch(t){e.error(t);e.error(t.stack);return[]}return i}function l(e){var t,i,s;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};i=a.get("signature.parameters",e)||{};Object.keys(i).forEach(function(e){if(i[e].filter&&Object.prototype.hasOwnProperty.call(i[e].filter,"value")&&(i[e].filter.format===undefined||i[e].filter.format==="plain")){t.params[e]=[i[e].filter.value]}if(i[e].launcherValue&&Object.prototype.hasOwnProperty.call(i[e].launcherValue,"value")&&(i[e].launcherValue.format===undefined||i[e].launcherValue.format==="plain")){t.params[e]=[i[e].launcherValue.value]}});s=p.constructShellHash(t);if(!s){return undefined}return s}function c(e){var t,a,i;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};a=e.parameters||{};Object.keys(a).forEach(function(e){if(a.hasOwnProperty(e)&&typeof a[e].value==="object"){t.params[e]=[a[e].value.value]}});i=p.constructShellHash(t);if(!i){return undefined}return i}return{formatSite:u,toHashFromInbound:l,toHashFromOutbound:c,mapOne:r,_formatApplicationType:n}},true);
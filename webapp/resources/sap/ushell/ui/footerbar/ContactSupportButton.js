// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/ButtonRenderer","sap/m/library","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/ui/launchpad/ActionItem"],function(t,e,n,i,a,o,s,l,r){"use strict";var u=n.ButtonType;var h=r.extend("sap.ushell.ui.footerbar.ContactSupportButton",{metadata:{library:"sap.ushell"},renderer:"sap.m.ButtonRenderer"});h.prototype.init=function(){if(r.prototype.init){r.prototype.init.apply(this,arguments)}this.setIcon("sap-icon://email");this.setText(s.i18n.getText("contactSupportBtn"));this.attachPress(this.showContactSupportDialog);this.setEnabled()};h.prototype.showContactSupportDialog=function(){sap.ui.require(["sap/ui/layout/form/SimpleForm","sap/ui/layout/form/SimpleFormLayout","sap/m/TextArea","sap/m/Input","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Dialog","sap/m/Button","sap/ushell/UserActivityLog"],function(t,e,n,o,r,h,p,d,c,x){var g="",m="",C="",f=[],b,S;S=function(){this.oDialog.removeContent(this.oBottomSimpleForm.getId());this.oBottomSimpleForm.destroy();if(this.oClientContext.navigationData.applicationInformation){g=this.oClientContext.navigationData.applicationInformation.applicationType;m=this.oClientContext.navigationData.applicationInformation.url;C=this.oClientContext.navigationData.applicationInformation.additionalInformation}f.push(new p({text:this.translationBundle.getText("loginDetails")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));f.push(new h({text:this.translationBundle.getText("userFld")}));f.push(new p({text:this.oClientContext.userDetails.fullName||""}));f.push(new h({text:this.translationBundle.getText("serverFld")}));f.push(new p({text:window.location.host}));if(this.oClientContext.userDetails.eMail&&this.oClientContext.userDetails.eMail!==""){f.push(new h({text:this.translationBundle.getText("eMailFld")}));f.push(new p({text:this.oClientContext.userDetails.eMail||""}))}f.push(new h({text:this.translationBundle.getText("languageFld")}));f.push(new p({text:this.oClientContext.userDetails.Language||""}));if(this.oClientContext.shellState==="app"||this.oClientContext.shellState==="standalone"){f.push(new p({text:""}));f.push(new p({text:this.translationBundle.getText("navigationDataFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));f.push(new h({text:this.translationBundle.getText("hashFld")}));f.push(new p({text:this.oClientContext.navigationData.navigationHash||""}));f.push(new p({text:""}));f.push(new p({text:this.translationBundle.getText("applicationInformationFld")}).addStyleClass("sapUshellContactSupportHeaderInfoText"));f.push(new h({text:this.translationBundle.getText("applicationTypeFld")}));f.push(new p({text:g}));f.push(new h({text:this.translationBundle.getText("urlFld")}));f.push(new p({text:m}));f.push(new h({text:this.translationBundle.getText("additionalInfoFld")}));f.push(new p({text:C}))}this.oBottomSimpleForm=new t("technicalInfoBox",{layout:e.ResponsiveLayout,content:f}).addStyleClass("sapUshellTechnicalInfoBox");if(i.os.ios&&i.system.phone){this.oBottomSimpleForm.addStyleClass("sapUshellContactSupportFixWidth")}b=this.oBottomSimpleForm.onAfterRendering;this.oBottomSimpleForm.onAfterRendering=function(){b.apply(this,arguments);var t=a(this.getDomRef());t.attr("tabIndex",0);setTimeout(function(){this.focus()}.bind(t),700)};this.oDialog.addContent(this.oBottomSimpleForm)}.bind(this);this._embedLoginDetailsInBottomForm=S;this.translationBundle=s.i18n;this.oClientContext=x.getMessageInfo();this.oLink=new r({text:this.translationBundle.getText("technicalDataLink")});this.oBottomSimpleForm=new t("bottomForm",{editable:false,content:[this.oLink]});this.sendButton=new c("contactSupportSendBtn",{text:this.translationBundle.getText("sendBtn"),type:u.Emphasized,enabled:true,press:function(){this.oSubjectInput.fireChange();this.oTextArea.fireChange();if(this.oSubjectInput.getValueState()!=="Error"&&this.oTextArea.getValueState()!=="Error"){sap.ushell.Container.getServiceAsync("SupportTicket").then(function(t){var e=this.oSubjectInput.getValue();var n=this.oTextArea.getValue();t.createTicket({subject:e,text:n,clientContext:this.oClientContext}).done(function(){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.info(this.translationBundle.getText("supportTicketCreationSuccess"))}.bind(this))}.bind(this)).fail(function(){sap.ushell.Container.getServiceAsync("Message").then(function(t){t.error(this.translationBundle.getText("supportTicketCreationFailed"))}.bind(this))}.bind(this));this.oDialog.close()}.bind(this))}}.bind(this)});this.cancelButton=new c("contactSupportCancelBtn",{text:this.translationBundle.getText("cancelBtn"),press:function(){this.oDialog.close()}.bind(this)});var B=function(t){var e=t.getSource();if(!e.getValue()){if(e.getId()==="subjectInput"){e.setValueStateText(this.translationBundle.getText("subjectEmptyErrorMessage"))}if(e.getId()==="textArea"){e.setValueStateText(this.translationBundle.getText("txtAreaEmptyErrorMessage"))}e.setValueState("Error")}else{e.setValueState("None")}}.bind(this);this.oSubjectLabel=new h("subjectLabel",{text:this.translationBundle.getText("subjectLabel"),required:true});this.oSubjectInput=new o("subjectInput",{});this.oSubjectInput.attachLiveChange(B);this.oSubjectInput.attachChange(B);this.oTextAreaLabel=new h("textAreaLabel",{text:this.translationBundle.getText("txtAreaLabel"),required:true});this.oTextArea=new n("textArea",{rows:7});this.oTextArea.attachLiveChange(B);this.oTextArea.attachChange(B);this.oTopSimpleForm=new t("topForm",{editable:false,content:[this.oSubjectLabel,this.oSubjectInput,this.oTextAreaLabel,this.oTextArea],layout:e.ResponsiveGridLayout});this.oDialog=new d({id:"ContactSupportDialog",title:this.translationBundle.getText("contactSupportBtn"),contentWidth:"29.6rem",leftButton:this.sendButton,rightButton:this.cancelButton,initialFocus:"subjectInput",afterOpen:function(){a("#textArea").on("focusout",function(){window.scrollTo(0,0)})},afterClose:function(){this.oDialog.destroy();if(window.document.activeElement&&window.document.activeElement.tagName==="BODY"){window.document.getElementById("meAreaHeaderButton").focus()}}.bind(this)}).addStyleClass("sapUshellContactSupportDialog").addStyleClass("sapContrastPlus");this.oSubjectInput.setPlaceholder(this.translationBundle.getText("subjectPlaceHolderHeader"));this.oTextArea.setPlaceholder(this.translationBundle.getText("txtAreaPlaceHolderHeader"));this.oLink.attachPress(S.bind(this));this.oDialog.addCustomData(new l({key:"aria-label",value:this.translationBundle.getText("ContactSupportArialLabel"),writeToDom:true}));this.oDialog.addContent(this.oTopSimpleForm);this.oDialog.addContent(this.oBottomSimpleForm);this.oDialog.open()}.bind(this))};h.prototype.setEnabled=function(e){if(!sap.ushell.Container){if(this.getEnabled()){t.warning("Disabling 'Contact Support' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.ContactSupportButton")}e=false}r.prototype.setEnabled.call(this,e)};return h});
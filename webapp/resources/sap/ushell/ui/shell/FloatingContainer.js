// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/Device","sap/ui/performance/Measurement","sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/EventHub","sap/ui/core/Configuration","sap/ushell/library"],function(e,t,a,i,o,n,s){"use strict";var r=e.extend("sap.ushell.ui.shell.FloatingContainer",{metadata:{library:"sap.ushell",properties:{},aggregations:{content:{type:"sap.ui.core.Control",multiple:true}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUshellFloatingContainer");e.openEnd();if(t.getContent()&&t.getContent().length){e.renderControl(t.getContent()[0])}e.close("div")}}});r.prototype.init=function(){t.resize.attachHandler(r.prototype._handleResize,this)};r.prototype._getWindowHeight=function(){return i(window).height()};r.prototype._setContainerHeight=function(e,t){e.css("max-height",t)};r.prototype._handleResize=function(e){a.start("FLP:FloatingContainer_handleResize","resizing floating container","FLP");if(i(".sapUshellFloatingContainer").parent()[0]&&i(".sapUshellContainerDocked").length===0){this.oWrapper=i(".sapUshellFloatingContainer").parent()[0];this.oWrapper.style.cssText=this.oStorage.get("floatingContainerStyle");var r=window.matchMedia?window.matchMedia("(max-width: 417px)").matches:false;this.adjustPosition(e,r)}else if(i(".sapUshellFloatingContainer").parent()[0]&&i(".sapUshellContainerDocked").length){if(i("#canvas").hasClass("sapUshellContainer-Narrow-Right")){var l;if(s.getRTL()){i("#sapUshellFloatingContainerWrapper").css("left",416/i(window).width()*100+"%");l=416/i(window).width()*100+"%;"}else{i("#sapUshellFloatingContainerWrapper").css("left",100-416/i(window).width()*100+"%");l=100-416/i(window).width()*100+"%;"}this.oWrapper.style.cssText="left:"+l+this.oWrapper.style.cssText.substring(this.oWrapper.style.cssText.indexOf("top"));this.oStorage.put("floatingContainerStyle",this.oWrapper.style.cssText)}}if(i(".sapUshellContainerDocked").length>0){sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerDockedIsResize");n.emit("ShellFloatingContainerDockedIsResized",Date.now())}var p=t.media.getCurrentRange(t.media.RANGESETS.SAP_STANDARD);if(p.name!=="Desktop"&&i(".sapUiMedia-Std-Desktop").width()-416<p.from&&i(".sapUshellContainerDocked").length){i("#canvas, .sapUshellShellHead").removeClass("sapUshellContainerDocked");if(i("#canvas").hasClass("sapUshellContainer-Narrow-Right")){i("#canvas").removeClass("sapUshellContainer-Narrow-Right sapUshellMoveCanvasRight")}else{i("#canvas").removeClass("sapUshellContainer-Narrow-Left sapUshellMoveCanvasLeft")}i(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().byId("mainShell").getController()._handleAnimations(false);var h=new o(o.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");if(h){h.put("lastState","floating")}sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDockedOnResize");i("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDocked sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");var g=sap.ui.getCore().byId("viewPortContainer");if(g){g._handleSizeChange()}}a.end("FLP:FloatingContainer_handleResize")};r.prototype.adjustPosition=function(e,t){var a=e?e.width:i(window).width(),o=e?e.height:i(window).height(),n=this.oContainer.width(),r=this.oContainer.height(),l,p,h,g,d=s.getRTL();t=t!==undefined?t:false;if(this.oWrapper){h=this.oWrapper.style.left.replace("%","");h=a*h/100;g=this.oWrapper.style.top.replace("%","");g=o*g/100;if(!isNaN(h)&&!isNaN(g)&&!t){if(d){l=h<n||h>a;if(l){h=h<n?n:a}}else{l=h<0||a<h+n;if(l){h=h<0?0:a-n}}p=g<0||o<g+r;if(p){g=g<0?0:o-r}if(!l&&!p){this.oWrapper.style.left=h*100/a+"%";this.oWrapper.style.top=g*100/o+"%";this.oWrapper.style.position="absolute";return}this.oWrapper.style.left=h*100/a+"%";this.oWrapper.style.top=g*100/o+"%";this.oWrapper.style.position="absolute"}}};r.prototype.handleDrop=function(){if(this.oWrapper){this.adjustPosition();this.oStorage.put("floatingContainerStyle",this.oWrapper.style.cssText)}};r.prototype.setContent=function(e){if(this.getDomRef()){var t=sap.ui.getCore().createRenderManager();t.renderControl(e);t.flush(this.getDomRef());t.destroy()}this.setAggregation("content",e,true)};r.prototype.onAfterRendering=function(){this.oStorage=this.oStorage||new o(o.Type.local,"com.sap.ushell.adapters.local.FloatingContainer");this.oContainer=i(".sapUshellFloatingContainer");this.oWrapper=i(".sapUshellFloatingContainer").parent()[0]};r.prototype.exit=function(){t.resize.detachHandler(r.prototype._resizeHandler,this)};return r});
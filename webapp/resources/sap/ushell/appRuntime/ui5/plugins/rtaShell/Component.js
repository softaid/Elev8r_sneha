// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Component","sap/ushell/appRuntime/ui5/plugins/baseRta/Renderer","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils","sap/ui/thirdparty/jquery"],function(e,t,i,n){"use strict";var s;function r(){return{sComponentName:"sap.ushell.appRuntime.ui5.plugins.rtaShell",layer:"CUSTOMER",id:"RTA_AppRuntime_Plugin_ActionButton",text:"RTA_BUTTON_TEXT",icon:"sap-icon://wrench",visible:false}}function a(e,t){if(e){e.setHeaderVisibility(t,false)}}function o(e){return new Promise(function(t,i){a(e,false);s.postMessageToApp("user.postapi.rtaPlugin","startUIAdaptation").done(t).fail(i)})}return e.extend("sap.ushell.appRuntime.ui5.plugins.rtaShell.Component",{metadata:{manifest:"json",library:"sap.ushell"},init:function(){this.mConfig=r();s=this.getComponentData().oPostMessageInterface;this._registerPostMessages()},_registerPostMessages:function(){s.registerPostMessageAPIs({"user.postapi.rtaPlugin":{inCalls:{activatePlugin:{executeServiceCallFn:function(){return s.createPostMessageResult(this._initPlugin())}.bind(this)},showAdaptUI:{executeServiceCallFn:function(){this._changeActionButtonVisibility(true);return s.createPostMessageResult()}.bind(this)},switchToolbarVisibility:{executeServiceCallFn:function(e){var t=e.oMessageData.body.visible;a(this.oRenderer,t);return s.createPostMessageResult()}.bind(this)}},outCalls:{startUIAdaptation:{}}}})},_initPlugin:function(){if(this.bIsInitialized){return(new n.Deferred).resolve()}this.bIsInitialized=true;this.mConfig.i18n=this.getModel("i18n").getResourceBundle();return new n.Deferred(function(e){t.getRenderer(this).then(function(e){this.oRenderer=e}.bind(this)).then(function(){return t.createActionButton(this,o.bind(undefined,this.oRenderer),this.mConfig.visible)}.bind(this)).then(function(){return i.getAppLifeCycleService()}).then(function(e){e.attachAppLoaded(this._onAppLoaded,this)}.bind(this)).catch(function(e){this.bIsInitialized=false;return Promise.reject(e)}.bind(this)).then(e.resolve,e.reject)}.bind(this)).promise()},_changeActionButtonVisibility:function(e){var t=sap.ui.getCore().byId(this.mConfig.id);if(t){t.setVisible(e)}},_onAppLoaded:function(){this._changeActionButtonVisibility(false)},exit:function(){if(this.oRenderer){a(this.oRenderer,false)}return i.getAppLifeCycleService().then(function(e){e.detachAppLoaded(this._onAppLoaded,this);if(this._onRendererCreated){var t=i.getContainer();t.detachRendererCreatedEvent(this._onRendererCreated,this)}}.bind(this))}})});
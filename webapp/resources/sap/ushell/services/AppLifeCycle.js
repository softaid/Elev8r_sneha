// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/EventProvider","sap/ushell/TechnicalParameters","sap/ushell/AppInfoParameters","sap/base/Log","sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/EventHub","sap/ui/thirdparty/hasher"],function(e,t,n,a,r,i,o){"use strict";var p="appLoaded";function s(r,s,c,u){var l,f,d;this.getCurrentApplication=function(){return l};this.attachAppLoaded=function(e,t,n){d.attachEvent(p,e,t,n)};this.detachAppLoaded=function(e,t){d.detachEvent(p,e,t)};this.prepareCurrentAppObject=function(e,t,n,a){v(e,t,n,a)};this.reloadCurrentApp=function(){i.emit("reloadCurrentApp",{sAppContainerId:f.getId(),sCurrentHash:o.getHash(),date:Date.now()})};d=new e;if(sap.ushell.Container.inAppRuntime()===false){if(sap.ushell.Container.getRenderer()){h()}else{var g=function(){h();sap.ushell.Container.detachRendererCreatedEvent(g)};sap.ushell.Container.attachRendererCreatedEvent(g)}}function h(){var e=sap.ui.getCore().byId("viewPortContainer");if(!e||typeof e.attachAfterNavigate!=="function"){a.error("Error during instantiation of AppLifeCycle service","Could not attach to afterNavigate event","sap.ushell.services.AppLifeCycle");return}e.attachAfterNavigate(function(e){var t;var n;var a;var r;var i;var o=false;if(e.mParameters.toId.indexOf("applicationShellPage")===0){n=e.mParameters.to.getApp()}else if(e.mParameters.toId.indexOf("application")===0){n=e.mParameters.to}if(n&&typeof n.getComponentHandle==="function"&&n.getComponentHandle()){r=n.getComponentHandle().getInstance()}else if(n){t=n.getAggregation("child");if(t){r=t.getComponentInstance()}}else{r=sap.ui.getCore().getComponent(e.mParameters.to.getComponent())}if(r){i=r.getId();o=i.indexOf("Shell-home-component")!==-1||i.indexOf("pages-component")!==-1||i.indexOf("workPageRuntime-component")!==-1||i.indexOf("Shell-appfinder-component")!==-1||i.indexOf("homeApp-component")!==-1||i.indexOf("runtimeSwitcher-component")!==-1}a=n&&typeof n.getApplicationType==="function"&&n.getApplicationType();if((!a||a==="URL")&&r){a="UI5"}v(a,r,o,n)})}function m(){var e=o.getHash();if(!e){return Promise.reject("Could not identify current application hash")}var t=sap.ushell.Container.getServiceAsync("URLParsing");return t.then(function(t){return t.parseShellHash(e)})}function v(e,a,r,o){f=o;l={applicationType:e,componentInstance:a,homePage:r,getTechnicalParameter:function(n){return t.getParameterValue(n,a,o,e)},getIntent:m,getInfo:function(e){return n.getInfo(e,l)},getSystemContext:function(){var e=sap.ushell.services.AppConfiguration.getCurrentApplication()||{};var t=e.contentProviderId||"";return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(t)})},disableKeepAliveAppRouterRetrigger:function(e){m().then(function(t){i.emit("disableKeepAliveRestoreRouterRetrigger",{disable:e,intent:t,componentId:l.componentInstance.oContainer.sId,date:Date.now()})})}};setTimeout(function(){d.fireEvent(p,l)},0)}}s.hasNoAdapter=true;return s},true);
// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/_AppState/LimitedBuffer","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,r){"use strict";var a=500;var o=18;function p(){this._init.apply(this,arguments)}p.prototype._init=function(t,r,o){var n=o&&o.config&&o.config.initialAppStates||{};var i=o&&o.config&&o.config.initialAppStatesPromise;this._oServiceInstance=t;this._oBackendAdapter=r;if(!p.prototype.data){p.prototype.data=new e(a)}if(i){i.then(function(e){if(typeof e==="object"){Object.keys(e).forEach(function(t){p.prototype.data.addAsHead(t,e[t])})}})}Object.keys(n).forEach(function(e){p.prototype.data.addAsHead(e,n[e])})};p.prototype.saveAppState=function(e,t,a,o,n,i,s,d){this.sComponent=n;var c=new r.Deferred;p.prototype.data.addAsHead(e,a,s,d);if(this._oBackendAdapter&&!i){return this._oBackendAdapter.saveAppState(e,t,a,o,n,s,d)}c.resolve();return c.promise()};p.prototype._checkIfTransient=function(e){return e.startsWith("TAS")};p.prototype.loadAppState=function(e){var a=new r.Deferred,n=p.prototype.data.getByKey(e);if(n){setTimeout(function(){a.resolve(e,n.value,n.persistencyMethod,n.persistencySettings)},0);return a.promise()}try{if(window.opener&&window.opener.sap&&window.opener.sap.ushell){var i=window.opener.sap.ui.require("sap/ushell/services/AppState").WindowAdapter.prototype.data.getByKey(e);if(i){a.resolve(e,i.value);return a.promise()}}}catch(e){if(e.code===o){t.warning("AppState.js - loadAppState: Opener is not of the same origin and cannot be used for AppState resolving.")}else{t.warning("AppState.js - loadAppState: Opener is a FLP but AppState could not get resolved from there.")}}if(this._oBackendAdapter&&!this._checkIfTransient(e)){this._oBackendAdapter.loadAppState(e).done(function(e,t,r,o){p.prototype.data.addAsHead(e,t);a.resolve(e,t,r,o)}).fail(a.reject.bind(a));return a.promise()}a.reject("AppState.js - loadAppState: Application State could not be loaded");return a.promise()};p.prototype.deleteAppState=function(e){var t=new r.Deferred;p.prototype.data.deleteByKey(e);if(this._oBackendAdapter&&this._oBackendAdapter.deleteAppState&&!this._checkIfTransient(e)){return this._oBackendAdapter.deleteAppState(e)}t.resolve();return t.promise()};p.prototype.getSupportedPersistencyMethods=function(){if(this._oBackendAdapter&&this._oBackendAdapter.getSupportedPersistencyMethods){return this._oBackendAdapter.getSupportedPersistencyMethods()}return[]};return p});
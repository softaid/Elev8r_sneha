// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/_AppState/AppStatePersistencyMethod","sap/ui/thirdparty/jquery","sap/base/Log"],function(e,t,r){"use strict";var n=function(e,t,r){this._oConfig=r&&r.config};n.prototype._getPersonalizationService=function(){return sap.ushell.Container.getServiceAsync("Personalization")};n.prototype.saveAppState=function(e,n,o,i,s,a,u){var c=new t.Deferred;this._getPersonalizationService().then(function(t){t.createEmptyContainer(e,{keyCategory:t.constants.keyCategory.GENERATED_KEY,writeFrequency:t.constants.writeFrequency.HIGH,clientStorageAllowed:false}).done(function(e){e.setItemValue("appStateData",o);e.setItemValue("persistencyMethod",a);e.setItemValue("persistencySettings",u);e.setItemValue("createdBy",sap.ushell.Container&&sap.ushell.Container.getUser&&sap.ushell.Container.getUser().getId());e.save().done(function(){c.resolve()}).fail(function(e){c.reject(e);r.error(e)})}).fail(function(e){r.error(e);c.reject(e)})});return c.promise()};n.prototype.loadAppState=function(n){var o=new t.Deferred,i=this;this._getPersonalizationService().then(function(t){t.getContainer(n,{keyCategory:t.constants.keyCategory.GENERATED_KEY,writeFrequency:t.constants.writeFrequency.HIGH,clientStorageAllowed:false}).done(function(t){var r=t.getItemValue("appStateData"),s=t.getItemValue("persistencyMethod"),a=t.getItemValue("persistencySettings"),u=t.getItemValue("createdBy");if(s===undefined){o.resolve(n,r)}else if(s===e.PersonalState){if(i.getCurrentUserForTesting()===""||i.getCurrentUserForTesting()===u){o.resolve(n,r,s,a)}else{o.reject("Unauthorized User ID")}}}).fail(function(e){r.error(e);o.reject(e)})});return o.promise()};n.prototype.deleteAppState=function(e){var n=new t.Deferred;this._getPersonalizationService().then(function(t){t.delContainer(e).done(function(){n.resolve()}).fail(function(e){r.error(e);n.reject(e)})});return n.promise()};n.prototype.getCurrentUserForTesting=function(){return""};n.prototype.getSupportedPersistencyMethods=function(){return[]};return n},false);
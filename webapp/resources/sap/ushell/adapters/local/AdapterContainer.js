// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/util/Storage","sap/ushell/utils"],function(e,t,n){"use strict";var s;function r(){return new t(t.Type.local,"com.sap.ushell.adapters.sandbox.Personalization")}function o(e){try{return JSON.parse(e)}catch(e){return undefined}}function i(e){return JSON.stringify(e)}function a(e){if(e===undefined){return undefined}try{return JSON.parse(JSON.stringify(e))}catch(e){return undefined}}var u=function(e,t,r){s=r;this._sContainerKey=e;this._sStorageType=t;this._oItemMap=new n.Map};u.prototype.load=function(){var t=new e.Deferred;var n=sap.ui.require("sap/ushell/adapters/local/PersonalizationAdapter");switch(this._sStorageType){case n.prototype.constants.storage.LOCAL_STORAGE:var i=r();setTimeout(function(){var e=i.get(this._sContainerKey);this._oItemMap.entries=o(e)||{};t.resolve(this)}.bind(this),0);break;case n.prototype.constants.storage.MEMORY:setTimeout(function(){this._oItemMap.entries=a(s[this._sContainerKey])||{};t.resolve(this)}.bind(this),0);break;default:setTimeout(function(){t.reject("unknown storage type")},0)}return t.promise()};u.prototype.save=function(){var t=new e.Deferred;var n=sap.ui.require("sap/ushell/adapters/local/PersonalizationAdapter");switch(this._sStorageType){case n.prototype.constants.storage.LOCAL_STORAGE:var o=r();setTimeout(function(){var e=i(this._oItemMap.entries);o.put(this._sContainerKey,e);t.resolve()}.bind(this),0);break;case n.prototype.constants.storage.MEMORY:setTimeout(function(){s[this._sContainerKey]=a(this._oItemMap.entries);t.resolve()}.bind(this),0);break;default:setTimeout(function(){t.reject("unknown storage type")},0)}return t.promise()};u.prototype.del=function(){var t=new e.Deferred;var n=sap.ui.require("sap/ushell/adapters/local/PersonalizationAdapter");switch(this._sStorageType){case n.prototype.constants.storage.LOCAL_STORAGE:var o=r();setTimeout(function(){o.remove(this._sContainerKey);this._oItemMap.entries={};t.resolve()}.bind(this),0);break;case n.prototype.constants.storage.MEMORY:setTimeout(function(){if(s&&s[this._sContainerKey]){delete s[this._sContainerKey]}this._oItemMap.entries={};t.resolve()}.bind(this),0);break;default:setTimeout(function(){t.reject("unknown storage type")},0)}return t.promise()};u.prototype.getItemKeys=function(){return this._oItemMap.keys()};u.prototype.containsItem=function(e){return this._oItemMap.containsKey(e)};u.prototype.getItemValue=function(e){return this._oItemMap.get(e)};u.prototype.setItemValue=function(e,t){this._oItemMap.put(e,t)};u.prototype.delItem=function(e){this._oItemMap.remove(e)};return u},false);
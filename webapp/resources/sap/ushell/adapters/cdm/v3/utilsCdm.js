// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/util/merge","sap/base/util/deepEqual","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/utils/UrlParsing","sap/base/Log"],function(e,t,a,i,r,s,n,o,p,u,l){"use strict";var c={};c.getMember=function(t,a){return e.getMember(t,a)};c.getNestedObjectProperty=function(t,a,i){return e.getNestedObjectProperty(t,a,i)};c.mapOne=function(e,s,o,u,l,c){var m=false;s=i({},s);o=i({},o);u=i({},u);l=i({},l);u=u||{};l=l||{};var f={};f.semanticObject=this.getMember(s,"semanticObject");f.action=this.getMember(s,"action");var d=t.getConfig(u);f.title=t.getTitle([undefined,d,s,o]);f.info=t.getInfo([undefined,d,s,o]);f.icon=t.getIcon([undefined,d,s,o]);f.subTitle=t.getSubTitle([undefined,d,s,o]);f.shortTitle=t.getShortTitle([undefined,d,s,o]);f.keywords=t.getKeywords([undefined,d,s,o]);f.numberUnit=t.getNumberUnit([undefined,d,undefined,undefined]);f.deviceTypes=this.getMember(o,"sap|ui.deviceTypes")||{};["desktop","tablet","phone"].forEach(function(e){if(Object.prototype.hasOwnProperty.call(this.getMember(s,"deviceTypes")||{},e)){f.deviceTypes[e]=s.deviceTypes[e]}if(!Object.prototype.hasOwnProperty.call(f.deviceTypes,e)){f.deviceTypes[e]=true}f.deviceTypes[e]=!!f.deviceTypes[e]}.bind(this));f.signature=this.getMember(s,"signature")||{};f.signature.parameters=this.getMember(f,"signature.parameters")||{};f.signature.additionalParameters=this.getMember(s,"signature.additionalParameters")||"allowed";var h=this.getMember(f,"signature.parameters.sap-hide-intent-link");if(h&&h.hasOwnProperty("defaultValue")){f.hideIntentLink=h.defaultValue.value==="true"}if(h&&!h.required&&h.hasOwnProperty("defaultValue")){delete f.signature.parameters["sap-hide-intent-link"]}var g=this.getMember(o,"sap|platform|runtime");f.resolutionResult=a.extend(true,{},g);if(g){f.resolutionResult["sap.platform.runtime"]=a.extend(true,{},g)}if(this.getMember(o,"sap|ui.technology")==="GUI"){f.resolutionResult["sap.gui"]=this.getMember(o,"sap|gui")}if(this.getMember(o,"sap|ui.technology")==="WDA"){f.resolutionResult["sap.wda"]=this.getMember(o,"sap|wda")}if(this.getMember(o,"sap|ui.technology")==="URL"){if(o["sap.url"]){f.resolutionResult["sap.platform.runtime"]=f.resolutionResult["sap.platform.runtime"]||{};f.resolutionResult.url=o["sap.url"].uri;f.resolutionResult["sap.platform.runtime"].url=o["sap.url"].uri}else if(g&&g.uri){f.resolutionResult["sap.platform.runtime"].url=g.uri;f.resolutionResult.url=g.uri}}if(!f.resolutionResult["sap.ui"]){f.resolutionResult["sap.ui"]={}}f.resolutionResult["sap.ui"].technology=this.getMember(o,"sap|ui.technology");f.resolutionResult.applicationType=this._formatApplicationType(f.resolutionResult,o);f.resolutionResult.systemAlias=f.resolutionResult.systemAlias||this.getMember(s,"systemAlias");f.resolutionResult.systemAliasSemantics="apply";f.resolutionResult.text=f.title;f.resolutionResult.appId=this.getMember(o,"sap|app.id");var b,y;var v=this.getMember(u,"vizConfig.sap|flp.indicatorDataSource");var M={};if(!r(l)){var O=this.getMember(l,"sap|app.type");if(O==="card"){m=true;M=n({},l,u.vizConfig)}else{M.componentName=this.getMember(l,"sap|ui5.componentName");var T=this.getMember(l,"sap|platform|runtime.componentProperties");if(T){M.componentProperties=T}if(this.getMember(l,"sap|platform|runtime.includeManifest")){M.componentProperties=M.componentProperties||{};M.componentProperties.manifest=n({},l,u.vizConfig);delete M.componentProperties.manifest["sap.platform.runtime"]}}}if(this.getMember(o,"sap|app.type")==="plugin"||this.getMember(o,"sap|flp.type")==="plugin"){return undefined}var R=this.getNestedObjectProperty([d,o,l],"sap|flp.tileSize");var P=this.getNestedObjectProperty([d,o,l],"sap|app.description");if(this.getMember(o,"sap|ui.technology")==="GUI"&&this.getMember(o,"sap|gui.transaction")){b=this.getMember(o,"sap|gui.transaction")}if(this.getMember(o,"sap|ui.technology")==="WDA"&&this.getMember(o,"sap|wda.applicationId")){b=this.getMember(o,"sap|wda.applicationId")}var j=this.getNestedObjectProperty([d,o,l],"sap|app.dataSources");if(this.getMember(o,"sap|app.id")){y=this.getMember(o,"sap|app.id")}var I=p.getContentProviderId(o)||"";f.tileResolutionResult={appId:y,title:f.title,subTitle:f.subTitle,icon:f.icon,size:R,info:f.info,keywords:f.keywords,tileComponentLoadInfo:M,indicatorDataSource:v,dataSources:j,description:P,runtimeInformation:g,technicalInformation:b,deviceTypes:f.deviceTypes,isCard:m,contentProviderId:I,numberUnit:f.numberUnit};var S=this.getMember(o,"sap|integration.urlTemplateId");var A=this.getTemplatePayloadFromSite(S,c);if(A){f.templateContext={payload:A,site:c,siteAppSection:o}}return f};c.getTemplatePayloadFromSite=function(e,t){if(!t||typeof e!=="string"){return null}var a=e.replace(/[.]/g,"|");return this.getMember(t.urlTemplates,a+".payload")};c._formatApplicationType=function(e,t){var a=e.applicationType;if(a){return a}var i=this.getMember(t,"sap|platform|runtime.componentProperties.self.name")||this.getMember(t,"sap|ui5.componentName");if(this.getMember(t,"sap|flp.appType")==="UI5"||this.getMember(t,"sap|ui.technology")==="UI5"){e.applicationType="SAPUI5";e.additionalInformation="SAPUI5.Component="+i;e.url=this.getMember(t,"sap|platform|runtime.componentProperties.url");e.applicationDependencies=this.getMember(t,"sap|platform|runtime.componentProperties");return"SAPUI5"}if(this.getMember(t,"sap|ui.technology")==="GUI"){e.applicationType="TR";e["sap.gui"]=this.getMember(t,"sap|gui");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"TR"}if(this.getMember(t,"sap|ui.technology")==="WDA"){e.applicationType="WDA";e["sap.wda"]=this.getMember(t,"sap|wda");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"WDA"}if(this.getMember(t,"sap|ui.technology")==="URL"){e.applicationType="URL";e.systemAlias=this.getMember(t,"sap|app.destination.name")}return"URL"};c.formatSite=function(e){var t=this;if(!e){return[]}var a=[];try{var i=Object.keys(e.applications||{}).sort();i.forEach(function(i){try{var r=e.applications[i];var s=this.getMember(r,"sap|app.crossNavigation.inbounds");if(s){var n=Object.keys(s).sort();n.forEach(function(i){var n=s[i];var o=t.mapOne(i,n,r,undefined,undefined,e);if(o){o.contentProviderId=p.getContentProviderId(r)||"";a.push(o)}})}}catch(e){l.error("Error in application "+i+": "+e,e.stack)}}.bind(this))}catch(e){l.error(e);l.error(e.stack);return[]}return a};c.toHashFromInbound=function(e){var t,a,i;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};a=s.get("signature.parameters",e)||{};Object.keys(a).forEach(function(e){if(a[e].filter&&Object.prototype.hasOwnProperty.call(a[e].filter,"value")&&(a[e].filter.format===undefined||a[e].filter.format==="plain")){t.params[e]=[a[e].filter.value]}if(a[e].launcherValue&&Object.prototype.hasOwnProperty.call(a[e].launcherValue,"value")&&(a[e].launcherValue.format===undefined||a[e].launcherValue.format==="plain")){t.params[e]=[a[e].launcherValue.value]}});i=u.constructShellHash(t);if(!i){return undefined}return i};c.toHashFromOutbound=function(e){var t,a,i;t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};a=e.parameters||{};Object.keys(a).forEach(function(e){if(a.hasOwnProperty(e)&&typeof a[e].value==="object"){t.params[e]=[a[e].value.value]}});i=u.constructShellHash(t);if(!i){return undefined}return i};c.toHashFromVizData=function(e,t){var a,i;if(!e.target){return undefined}a=e.target;if(a.type==="URL"){return a.url}var r=a.appId;var s=a.inboundId;if(r&&s){var n=p.getInboundTarget(t,r,s);i={};if(n){i.semanticObject=n.semanticObject;i.action=n.action;i.parameters=a.parameters||{};i.parameters["sap-ui-app-id-hint"]={value:{value:r,format:"plain"}};i.appSpecificRoute=a.appSpecificRoute||""}}else if(a.semanticObject&&a.action){i=a}return c.toHashFromTarget(i)};c.toHashFromTarget=function(e){try{var t={};var a=s.get("parameters",e)||{};Object.keys(a).forEach(function(e){t[e]=Array.isArray(a[e].value.value)?a[e].value.value:[a[e].value.value]});var i={target:{semanticObject:e.semanticObject,action:e.action},params:t,appSpecificRoute:e.appSpecificRoute};return"#"+u.constructShellHash(i)}catch(e){return undefined}};c.toTargetFromHash=function(e){var t=u.parseShellHash(e);if(t!==undefined){var a=t.params||{};if(Object.keys(a).length>0){t.parameters=[];Object.keys(a).forEach(function(e){var i=Array.isArray(a[e])?a[e]:[a[e]];i.forEach(function(a){var i={name:e,value:a};t.parameters.push(i)})})}delete t.params}else{t={type:"URL",url:e}}return t};c.isSameTarget=function(e,t){var a;if(e.type!==t.type){return false}if(e.type==="URL"){a=e.url===t.url}else{a=e.semanticObject===t.semanticObject&&e.action===t.action&&e.appSpecificRoute===t.appSpecificRoute&&o(e.parameters,t.parameters)}return a};return c},false);
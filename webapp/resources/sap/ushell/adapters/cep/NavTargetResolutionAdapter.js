// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/core/Configuration","sap/ui/thirdparty/jquery","sap/ushell/Container","sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds"],function(t,e,n,r,i){;"use strict";var o=function(t,e,n){this.oAdapterConfiguration=n;this._addVirtualInboundsToApplications();this.sCsrfToken=""};o.prototype._addVirtualInboundsToApplications=function(){var e=t.create("config.applications",this.oAdapterConfiguration);var n=i.getInbounds();n.forEach(function(t){var n=t.semanticObject+"-"+t.action;e[n]=t.resolutionResult})};o.prototype._getIntentForService=function(e){return sap.ushell.Container.getServiceAsync("URLParsing").then(function(n){var r=n.parseShellHash(e);var i={semanticObject:r.semanticObject,semanticObjectAction:r.action,intentParameters:r.params,queryParameters:{siteId:t.get("sap.cf.config.siteId")||""}};return i})};o.prototype._fetchCsrfToken=function(){if(this.sCsrfToken){return Promise.resolve(this.sCsrfToken)}return fetch(this.oAdapterConfiguration.config.navServiceUrl,{method:"HEAD",headers:{"x-csrf-token":"fetch","Accept-Language":e.getLanguageTag()}}).then(function(t){this.sCsrfToken=t.headers.get("x-csrf-token");return this.sCsrfToken}.bind(this))};o.prototype.toPromise=function(t){var e=this;return function(r){var i=new n.Deferred;t.call(e,r).then(i.resolve).catch(i.reject).finally(i.always);return i.promise()}};o.prototype.resolveHashFragment=function(t){return this.toPromise(this._resolveHashFragment).call(this,t)};o.prototype._resolveHashFragment=function(t){return this._fetchCsrfToken().then(function(){return this._getIntentForService(t)}.bind(this)).then(function(t){var n=this.oAdapterConfiguration.config.navServiceUrl+"/resolve";return fetch(n,{method:"POST",headers:{"Content-Type":"application/json; utf-8",Accept:"application/json","x-csrf-token":this.sCsrfToken,"Accept-Language":e.getLanguageTag()},body:JSON.stringify(t)})}.bind(this)).then(function(t){if(t.ok===false){return Promise.reject(t.statusText)}return t.json()}).then(function(t){var e=t.value||t;var n=Array.isArray(e)?e[0].url:e.url;return{additionalInformation:"",url:n,applicationType:"URL",navigationMode:"newWindow"}})};return o},false);